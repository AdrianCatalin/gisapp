Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError("this is null or not defined");var e=Object(this),g=e.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");b&&(c=b);for(d=0;d<g;){var f;Object.prototype.hasOwnProperty.call(e,d)&&(f=e[d],a.call(c,f,d,e));d++}});var availableHelpLanguages="en es de hu it pl fr ro sk".split(" "),availableLanguages=[];availableLanguages.en={names:[],translator:"Andreas Neumann"};availableLanguages.es={names:[],translator:"Samuel Mesa, Diana Galindo, Germán Carrillo, Ignacio Serrano Ayllón"};availableLanguages.de={names:[],translator:"Andreas Neumann"};availableLanguages.fr={names:[],translator:"Mayeul Kauffmann, Amandine Schloupt (Aguram)"};availableLanguages.it={names:[],translator:"Paolo Cavallini (Faunalia), Giovanni Allegri (Gis3W), Alessandro Pasotti (ItOpen)"};
availableLanguages.pt_PT={names:[],translator:"Nelson Silva, Giovanni Manghi (Faunalia)"};availableLanguages.uk={names:[],translator:"Pavlo Taranov"};availableLanguages.hu={names:[],translator:"Szilárd Lajcsik"};availableLanguages.ro={names:[],translator:"Tudor Bărăscu"};availableLanguages.ru={names:[],translator:"Nikolay Zhigalov"};availableLanguages.sl={names:[],translator:"Uroš Preložnik"};availableLanguages.nl={names:[],translator:"Carl Defevere"};availableLanguages.pl={names:[],translator:"Sławomir Bienias"};
availableLanguages.sk={names:[],translator:"Mrtin Baloga"};availableLanguages.en.names.en="English";availableLanguages.en.names.de="Englisch";availableLanguages.en.names.es="Inglés";availableLanguages.en.names.sl="angleščina";availableLanguages.en.names.sk="Anglicky";availableLanguages.de.names.en="German";availableLanguages.de.names.de="Deutsch";availableLanguages.de.names.es="Alemán";availableLanguages.de.names.sl="nemščina";availableLanguages.de.names.sk="Nemecky";
availableLanguages.sl.names.en="Slovenian";availableLanguages.sl.names.de="Slowenisch";availableLanguages.sl.names.es="esloveno";availableLanguages.sl.names.sl="slovenščina";availableLanguages.sl.names.sk="Slovinsky";availableLanguages.sk.names.en="Slovak";availableLanguages.sk.names.de="Slovak";availableLanguages.sk.names.es="Eslovaco";availableLanguages.sk.names.sl="Slovak";availableLanguages.sk.names.sk="Slovensky";var mapAppLoadingString=[];mapAppLoadingString.en="Loading map application...";
mapAppLoadingString.es="Cargando la aplicación del mapa...";mapAppLoadingString.de="Kartenapplikation wird geladen...";mapAppLoadingString.sl="Nalaganje aplikacije...";mapAppLoadingString.sk="Vytváram mapovú aplikáciu...";var mapLoadingString=[];mapLoadingString.en="Loading Map...";mapLoadingString.es="Cargando mapa...";mapLoadingString.de="Karte wird geladen...";mapLoadingString.sl="Nalaganje karte...";mapLoadingString.sk="Načítavam mapu...";var modeNavigationString=[];modeNavigationString.en="Mode: navigation. Shift/rectangle or mouse wheel for zooming.";
modeNavigationString.es="Modo: navegación. Shift/rectángulo o rueda del ratón para hacer zoom.";modeNavigationString.de="Modus: Navigation. Shift/Rechteck aufziehen oder Mausrad zum zoomen.";modeNavigationString.sl="Način: navigacija. Miška (lev gumb premik, kolešček povečava), Tipkovnica (smerne tipke in +-).";modeNavigationString.sk="Mód: Navigácia. Shift/obdlžnik alebo koliesko myši pre približovanie";var modeZoomRectangle=[];modeZoomRectangle.en="Mode: zoom with rectangle. Draw rectangle over region you wish to zoom in.";
modeZoomRectangle.es="Modo: zoom con rectángulo. Dibujar el rectángulo sobre la región que desea acercar.";modeZoomRectangle.de="Modus: Zoom mit Rechteck. Ziehen Sie die gewünschte Region auf.";modeZoomRectangle.sl="Način: povečava z pravokotnikom. Nariši pravokotnik na območju željene povečave.";modeZoomRectangle.sk="Mód: približovanie obdĺžnikom. Nakresli odbĺžnik nad oblasťou, ktorú chceš priblížiť";var modeObjectIdentificationString=[];modeObjectIdentificationString.en="Mode: object identification. Move the mouse over an object to identify it, click it to view its attribute data.";
modeObjectIdentificationString.es="Modo: Identificación de objeto. Mueva el cursor sobre un objeto para identificarlo, haga click sobre él para ver sus atributos.";modeObjectIdentificationString.de="Modus: Objektidentifikation. Bewegen Sie die Maus über das Objekt, um es zu identifizeren, klicken Sie es an, um seine Attributdaten anzuzeigen.";modeObjectIdentificationString.sl="Način: poizvedba. Premakni miško na objekt zanimanja za identifikacijo ali klikni na objektu za prikaz opisnih podatkov.";
modeObjectIdentificationString.sk="Mód: idenfikáca objektu. Posuň myš nad objekt pre identifikáciu klikni pre zobrazenie atribútov";var modeMapTipsString=[];modeMapTipsString.en="Mode: MapTips. Display on mouse over with Tooltips.";modeMapTipsString.es="Modo: MapTips. Despliega textos emergentes con el cursor del ratón.";modeMapTipsString.de="Modus: MapTips. Anzeige mit Mouseover über tooltips.";modeMapTipsString.sl="Mode: MapTips. Display on mouse over with Tooltips.";modeMapTipsString.sk="Mód: Malé pomôcky. Zobrazíš ponechaním kurzoru nad objektom";
var modeMeasureDistanceString=[];modeMeasureDistanceString.en="Mode: measure distance. Finish with double click.";modeMeasureDistanceString.es="Modo: medir distancia. Finalizar con doble click.";modeMeasureDistanceString.de="Modus: Distanzmessung. Beenden mit Doppelklick.";modeMeasureDistanceString.sl="Način: merjenje razdalje. Zaključi z dvoklikom.";modeMeasureDistanceString.sk="Mód: meranie. Ukončíš dvojklikom.";var modeMeasureAreaString=[];modeMeasureAreaString.en="Mode: measure area. Finish with double click.";
modeMeasureAreaString.es="Modo: medir área. Finalizar con doble click.";modeMeasureAreaString.de="Modus: Flächenmessung. Beenden mit Doppelklick.";modeMeasureAreaString.sl="Način: merjenje površine. Zaključi z dvoklikom.";modeMeasureAreaString.sk="Mód: meranie plochy. Ukončite dvojklikom,";var modeStreetViewString=[];modeStreetViewString.en="Mode: GoogleStreetView. Click on the road.";modeStreetViewString.es="Modo: GoogleStreetView. Pulsar sobre una carretera.";modeStreetViewString.de="Mode: GoogleStreetView. Click on the road.";
modeStreetViewString.sl="Način: GoogleStreetView. Klikni na cesto.";modeStreetViewString.sk="Mód: GoogleStreetView. Klikni na cestu";var modePrintingString=[];modePrintingString.en="Mode: printing. Move or rotate the map extent. Print with the 'Print'-Button.";modePrintingString.es="Modo: imprimir. Mueva o rote la extensión del mapa. Imprima con el botón 'imprimir'.";modePrintingString.de="Modus: Drucken. Verschieben oder Rotieren Sie den Kartenausschnitt. Drucken mit 'Drucken'-Knopf.";
modePrintingString.sl="Način: tiskanje. Premakni ali zasuči območje tiska. Nadaljuj z gumbom 'Tiskanje'.";modePrintingString.sk="Mód: Tlač. Posuňte, alebo otočte  rozsah mapy. Vytlačte stalčením tlačidla 'Tlač'.";var printLoadingString=[];printLoadingString.en="Printing initialised. Please wait...";printLoadingString.es="Impresión inicializada, por favor espere...";printLoadingString.de="Der Druckauftrag ist erfolgt. Bitte haben sie etwas Geduld...";printLoadingString.sl="Tiskanje se pripravlja. Prosimo počakajte...";
printLoadingString.sk="Tlačím, chvílenku strpenia...";var leftPanelTitleString=[];leftPanelTitleString.en="Info and Tools";leftPanelTitleString.es="Información y herramientas";leftPanelTitleString.de="Infos und Werkzeuge";leftPanelTitleString.sl="Informacije in orodja";leftPanelTitleString.sk="Info a nástroje";var searchPanelTitleString=[];searchPanelTitleString.en="Search";searchPanelTitleString.es="Buscar";searchPanelTitleString.de="Suche";searchPanelTitleString.sl="Iskanje";
searchPanelTitleString.sk="Vyhľadávanie";var mapThemeButtonTitleString=[];mapThemeButtonTitleString.en="Map themes";mapThemeButtonTitleString.es="Temas de mapas";mapThemeButtonTitleString.de="Kartenthemen";mapThemeButtonTitleString.sl="Tematske vsebine";mapThemeButtonTitleString.sk="Témy";var themeSwitcherWindowTitleString=[];themeSwitcherWindowTitleString.en="Map theme choice";themeSwitcherWindowTitleString.es="Elección de tema de mapa";themeSwitcherWindowTitleString.de="Kartenthemenwechsel";
themeSwitcherWindowTitleString.sl="Izbira vsebine";themeSwitcherWindowTitleString.sk="Výber témy";var themeSwitcherFilterLabelString=[];themeSwitcherFilterLabelString.en="Filter by map title: ";themeSwitcherFilterLabelString.es="Filtrar por título de mapa: ";themeSwitcherFilterLabelString.de="Filterung nach Kartentitel: ";themeSwitcherFilterLabelString.sl="Filter po naslovu vsebine: ";themeSwitcherFilterLabelString.sk="Filter podľa názvu mapy: ";var themeSwitcherAllThemesListViewString=[];
themeSwitcherAllThemesListViewString.en="All map themes";themeSwitcherAllThemesListViewString.es="Todos los temas de mapas";themeSwitcherAllThemesListViewString.de="Alle Kartenthemen";themeSwitcherAllThemesListViewString.sl="Vse vsebine";themeSwitcherAllThemesListViewString.sk="Všetky témy máp:";var themeSwitcherTooltipResponsibleString=[];themeSwitcherTooltipResponsibleString.en="Responsible: ";themeSwitcherTooltipResponsibleString.es="Responsable: ";themeSwitcherTooltipResponsibleString.de="Verantwortlich: ";
themeSwitcherTooltipResponsibleString.sl="Odgovornost: ";themeSwitcherTooltipResponsibleString.sk="Zodpovedný: ";var themeSwitcherTooltipTagString=[];themeSwitcherTooltipTagString.en="Tags: ";themeSwitcherTooltipTagString.es="Etiquetas: ";themeSwitcherTooltipTagString.de="Stichwörter: ";themeSwitcherTooltipTagString.sl="Oznake: ";themeSwitcherTooltipTagString.sk="Označenia: ";var themeSwitcherTooltipMapThemeString=[];themeSwitcherTooltipMapThemeString.en="Map theme: ";
themeSwitcherTooltipMapThemeString.es="Tema de mapa: ";themeSwitcherTooltipMapThemeString.de="Kartenthema: ";themeSwitcherTooltipMapThemeString.sl="Vsebina: ";themeSwitcherTooltipMapThemeString.sk="Téma mapy: ";var themeSwitcherTooltipUpdateString=[];themeSwitcherTooltipUpdateString.en="Update interval: ";themeSwitcherTooltipUpdateString.es="Intervalo de actualización: ";themeSwitcherTooltipUpdateString.de="Aktualisierung: ";themeSwitcherTooltipUpdateString.sl="Osvežitveni interval: ";
themeSwitcherTooltipUpdateString.sk="Interval aktualizácie: ";var themeSwitcherTooltipLastUpdateString=[];themeSwitcherTooltipLastUpdateString.en="Last update: ";themeSwitcherTooltipLastUpdateString.es="Última actualización: ";themeSwitcherTooltipLastUpdateString.de="Letze Aktualisierung: ";themeSwitcherTooltipLastUpdateString.sl="Zadnja sprememba: ";themeSwitcherTooltipLastUpdateString.sk="Posledná aktualizácia: ";var themeSwitcherTooltipPwProtectedString=[];
themeSwitcherTooltipPwProtectedString.en="password protected";themeSwitcherTooltipPwProtectedString.es="protegido por contraseña";themeSwitcherTooltipPwProtectedString.de="passwortgeschützt";themeSwitcherTooltipPwProtectedString.sl="zaščiteno z geslom";themeSwitcherTooltipPwProtectedString.sk="Chránené heslom";var emptyThemeSearchFieldString=[];emptyThemeSearchFieldString.en="Insert filter string";emptyThemeSearchFieldString.es="Inserte el texto para filtrar";emptyThemeSearchFieldString.de="Filtertext eingeben";
emptyThemeSearchFieldString.sl="Vnesi besedilo za filter";emptyThemeSearchFieldString.sk="Vložte text filtra";var resetThemeSearchFieldTooltipString=[];resetThemeSearchFieldTooltipString.en="Reset map theme search filter";resetThemeSearchFieldTooltipString.es="Borrar el filtro de búsqueda de temas de mapa";resetThemeSearchFieldTooltipString.de="Kartenthemenfilter zurücksetzen";resetThemeSearchFieldTooltipString.sl="Ponastavi iskalni filter";resetThemeSearchFieldTooltipString.sk="Reset vyhľadávacieho filtra pre tému mapy";
var mapPanelTitleString=[];mapPanelTitleString.en="Map";mapPanelTitleString.es="Mapa";mapPanelTitleString.de="Karte";mapPanelTitleString.sl="Karta";mapPanelTitleString.sk="Маpa";var layerTreeTitleString=[];layerTreeTitleString.en="Map Layers";layerTreeTitleString.es="Capas";layerTreeTitleString.de="Kartenebenen";layerTreeTitleString.sl="Sloji";layerTreeTitleString.sk="Vrstvy";var backgroundLayerTitleString=[];backgroundLayerTitleString.en="Background Layers";backgroundLayerTitleString.es="Capas de fondo";
backgroundLayerTitleString.de="Hintergrundebenen";backgroundLayerTitleString.sl="PODLAGE";backgroundLayerTitleString.sk="Podkladové vrstvy";var externalLayerTitleString=[];externalLayerTitleString.en="External Layers";externalLayerTitleString.es="Capas externas ";externalLayerTitleString.de="External Layers";externalLayerTitleString.sl="ZUNANJI SLOJI";externalLayerTitleString.sk="Externé vrstvy";var layerOrderPanelTitleString=[];layerOrderPanelTitleString.en="Layer order";
layerOrderPanelTitleString.es="Orden de capa";layerOrderPanelTitleString.de="Ebenenreihenfolge";layerOrderPanelTitleString.sl="Nastavitve slojev";layerOrderPanelTitleString.sk="Poradie vrstiev";var layerOrderPanelLayerSettingsTooltipString=[];layerOrderPanelLayerSettingsTooltipString.en="Settings";layerOrderPanelLayerSettingsTooltipString.es="Ajustes";layerOrderPanelLayerSettingsTooltipString.de="Einstellungen";layerOrderPanelLayerSettingsTooltipString.sl="Nastavitve";
layerOrderPanelLayerSettingsTooltipString.sk="Nastavenie";var layerOrderPanelVisibilityChangeTooltipString=[];layerOrderPanelVisibilityChangeTooltipString.en="Change Layer Visibility";layerOrderPanelVisibilityChangeTooltipString.es="Cambiar visibilidad de la capa";layerOrderPanelVisibilityChangeTooltipString.de="Ebenensichtbarkeit ändern";layerOrderPanelVisibilityChangeTooltipString.sl="Spremeni vidnost sloja";layerOrderPanelVisibilityChangeTooltipString.sk="Zmeniť viditeľnosť vrstiev";
var layerOrderPanelMoveLayerTextString=[];layerOrderPanelMoveLayerTextString.en="Move layer";layerOrderPanelMoveLayerTextString.es="Mover capa";layerOrderPanelMoveLayerTextString.de="Ebene verschieben";layerOrderPanelMoveLayerTextString.sl="Premakni sloj";layerOrderPanelMoveLayerTextString.sk="Posunúť vrstvu";var layerOrderPanelTransparencyTooltipString=[];layerOrderPanelTransparencyTooltipString.en="Transparency {0}%";layerOrderPanelTransparencyTooltipString.es="Transparencia {0}%";
layerOrderPanelTransparencyTooltipString.de="Transparenz {0}%";layerOrderPanelTransparencyTooltipString.sl="Prosojnost {0}%";layerOrderPanelTransparencyTooltipString.sk="Priesvitnosť {0}%";var legendTabTitleString=[];legendTabTitleString.en="Legend";legendTabTitleString.es="Leyenda";legendTabTitleString.de="Legende";legendTabTitleString.sl="Legenda";legendTabTitleString.sk="Legenda";var legendTabLoadingString=[];legendTabLoadingString.en="Loading legend, please wait...";
legendTabLoadingString.es="Cargando leyenda, por favor espere";legendTabLoadingString.de="Legende";legendTabLoadingString.sl="Nalaganje legende, prosimo počakajte...";legendTabLoadingString.sk="Načítavam legendu, strpenie...";var metadataTabTitleString=[];metadataTabTitleString.en="Metadata";metadataTabTitleString.es="Metadatos";metadataTabTitleString.de="Metadaten";metadataTabTitleString.sl="Metapodatki";metadataTabTitleString.sk="Metadata";var helpWindowTitleString=[];helpWindowTitleString.en="Help";
helpWindowTitleString.es="Ayuda";helpWindowTitleString.de="Hilfe";helpWindowTitleString.sl="Pomoč";helpWindowTitleString.sk="Pomoc";var legendMetadataWindowTitleString=[];legendMetadataWindowTitleString.en="Legend and metadata information of layer";legendMetadataWindowTitleString.es="Información de Metadatos y Leyenda de la capa";legendMetadataWindowTitleString.de="Legende und Metadaten der Ebene";legendMetadataWindowTitleString.sl="Legenda in metapodatki za sloj";
legendMetadataWindowTitleString.sk="Legenda a metadata vrstvy";var metadataSectionTitleString=[];metadataSectionTitleString.en="Metadata of layer";metadataSectionTitleString.es="Metadatos de la capa";metadataSectionTitleString.de="Metadaten der Ebene";metadataSectionTitleString.sl="Metapodatki za sloj";metadataSectionTitleString.sk="Metadata vrstvy";var abstractString=[];abstractString.en="Abstract:";abstractString.es="Resumen:";abstractString.de="Zusammenfassung:";abstractString.sl="Opis:";
abstractString.sk="Abstrakt";var layerQueryable=[];layerQueryable.en="This layer is queryable: ";layerQueryable.es="Esta capa se puede consultar: ";layerQueryable.de="Diese Ebene ist abfragbar: ";layerQueryable.sl="Sloj omogoča poizvedovanje: ";layerQueryable.sk="V tejto vrstve je možné vyhľadávať: ";var yesString=[];yesString.en="yes";yesString.es="sí";yesString.de="ja";yesString.sl="da";yesString.sk="áno";var noString=[];noString.en="no";noString.es="no";noString.de="nein";noString.sl="ne";
noString.sk="nie";var layerGroupString=[];layerGroupString.en="Layer group";layerGroupString.es="Grupo de capas";layerGroupString.de="Ebenengruppe";layerGroupString.sl="Skupina slojev";layerGroupString.sk="Skupina vrstiev";var displayFieldString=[];displayFieldString.en="Display-Field";displayFieldString.es="Mostrar campo";displayFieldString.de="Anzeigefeld";displayFieldString.sl="Polje za prikaz";displayFieldString.sk="Zobrazované pole";var coordinateSystemsString=[];coordinateSystemsString.en="Available Coordinate Systems";
coordinateSystemsString.es="Sistemas de coordenadas disponibles";coordinateSystemsString.de="Verfügbare Koordinatensysteme";coordinateSystemsString.sl="Razpoložljivi koordinatni sistemi";coordinateSystemsString.sk="Dostupné koordinačné systémy";var geographicExtentString=[];geographicExtentString.en="Geographic Extent";geographicExtentString.es="Extensión geográfica";geographicExtentString.de="Geographischer Ausschnitt";geographicExtentString.sl="Območje";geographicExtentString.sk="Rozsah";
var westString=[];westString.en="west";westString.es="Oeste";westString.de="Westen";westString.sl="zahod";westString.sk="západ";var eastString=[];eastString.en="east";eastString.es="Este";eastString.de="Osten";eastString.sl="vzhod";eastString.sk="východ";var northString=[];northString.en="north";northString.es="Norte";northString.de="Norden";northString.sl="sever";northString.sk="sever";var southString=[];southString.en="south";southString.es="Sur";southString.de="Süden";southString.sl="jug";
southString.sk="juh";var attributesString=[];attributesString.en="Attributes / Fields";attributesString.es="Atributos";attributesString.de="Attribute / Felder";attributesString.sl="Opisni podatki / polja";attributesString.sk="Attribúty / Polia";var attributeNameString=[];attributeNameString.en="Attribute name";attributeNameString.es="Nombre del atributo";attributeNameString.de="Attributname";attributeNameString.sl="ime";attributeNameString.sk="Názov atribútu";var attributeTypeString=[];
attributeTypeString.en="Type";attributeTypeString.es="Tipo";attributeTypeString.de="Typ";attributeTypeString.sl="tip";attributeTypeString.sk="Typ";var attributeCommentString=[];attributeCommentString.en="Comment";attributeCommentString.es="Comentario";attributeCommentString.de="Kommentar";attributeCommentString.sl="komentar";attributeCommentString.sk="Poznámka";var attributeLengthString=[];attributeLengthString.en="Length";attributeLengthString.es="Longitud";attributeLengthString.de="Länge";
attributeLengthString.sl="dolžina";attributeLengthString.sk="Dĺžka";var attributePrecisionString=[];attributePrecisionString.en="Precision";attributePrecisionString.es="Precisión";attributePrecisionString.de="Präzision";attributePrecisionString.sl="natančnost";attributePrecisionString.sk="Presnosť";var objectIdentificationTextLabel=[];objectIdentificationTextLabel.en="Object identification: ";objectIdentificationTextLabel.es="Identificación de objetos: ";objectIdentificationTextLabel.de="Objektidentifikation: ";
objectIdentificationTextLabel.sl="poizvedba na: ";objectIdentificationTextLabel.sk="Informácie o objekte: ";var coordinateTextLabel=[];coordinateTextLabel.en="Coordinate:";coordinateTextLabel.es="Coordenadas:";coordinateTextLabel.de="Koordinate:";coordinateTextLabel.sl="koordinate:";coordinateTextLabel.sk="Súradnice:";var searchFieldDefaultTextString=[];searchFieldDefaultTextString.en="Search (addresses, parcel-nrs, names, etc.)";searchFieldDefaultTextString.es="Buscar (direcciones, registros, nombres, etc.)";
searchFieldDefaultTextString.de="Suche (Adressen, Parzellenr, Flurnamen, etc.)";searchFieldDefaultTextString.sl="Iskanje (naslovi, parcele, imena...)";searchFieldDefaultTextString.sk="Hľadaj...";var searchButtonString=[];searchButtonString.en="Search";searchButtonString.es="Buscar";searchButtonString.de="Suchen";searchButtonString.sl="Išči";searchButtonString.sk="Hľadaj!";var resetButtonString=[];resetButtonString.en="Clear";resetButtonString.es="Limpiar";resetButtonString.de="Zurücksetzen";
resetButtonString.sl="Pobriši";resetButtonString.sk="Vyčisti";var pleaseWaitString=[];pleaseWaitString.en="Please wait";pleaseWaitString.es="Por favor espere";pleaseWaitString.de="Bitte warten";pleaseWaitString.sl="Prosimo počakajte";pleaseWaitString.sk="Prosím čakajte";var searchResultString=[];searchResultString.en="Search result";searchResultString.es="Resultado de la búsqueda";searchResultString.de="Suchresultat";searchResultString.sl="Rezultati iskanja";searchResultString.sk="Výsledky hľadania";
var networkErrorString=[];networkErrorString.en="Network error";networkErrorString.es="Error de red";networkErrorString.de="Netzwerkfehler";networkErrorString.sl="Težava z omrežjem";networkErrorString.sk="Chyba siete";var missingOrInvalidSearchParams=[];missingOrInvalidSearchParams.en="Missing or invalid values in search form";missingOrInvalidSearchParams.es="Valores inválidos o faltantes en el formulario de búsqueda";missingOrInvalidSearchParams.de="Fehlende oder ungültige Werte im Suchformular";
missingOrInvalidSearchParams.sl="Nepopolna ali nepravilna vrednost iskanja";missingOrInvalidSearchParams.sk="Chýbajúce alebo nesprávne zadané hodnoty";var searchErrorString=[];searchErrorString.en="Error during search";searchErrorString.es="Error en la búsqueda";searchErrorString.de="Fehler bei Suche";searchErrorString.sl="Napaka pri iskanju";searchErrorString.sk="Chyba počas hľadania";var searchNoRecordsFoundString=[];searchNoRecordsFoundString.en="No records found";
searchNoRecordsFoundString.es="Búsqueda sin resultados";searchNoRecordsFoundString.de="Fehler bei Suche";searchNoRecordsFoundString.sl="ni rezultatov";searchNoRecordsFoundString.sk="Nič sa nenašlo";var printSettingsToolbarTitleString=[];printSettingsToolbarTitleString.en="Print Settings";printSettingsToolbarTitleString.es="Configuración de impresión";printSettingsToolbarTitleString.de="Druckeinstellungen";printSettingsToolbarTitleString.sl="Nastavitve tiskanja";
printSettingsToolbarTitleString.sk="Nastavenia tlače";var printSettingsRotationTextlabelString=[];printSettingsRotationTextlabelString.en="Rotation: ";printSettingsRotationTextlabelString.es="Rotación: ";printSettingsRotationTextlabelString.de="Rotation: ";printSettingsRotationTextlabelString.sl="rotacija: ";printSettingsRotationTextlabelString.sk="Otočiť: ";var printButtonTextString=[];printButtonTextString.en="Print";printButtonTextString.es="Imprimir";printButtonTextString.de="Drucken";
printButtonTextString.sl="tiskanje";printButtonTextString.sk="Tlač";var printCancelButtonTextString=[];printCancelButtonTextString.en="Cancel";printCancelButtonTextString.es="Cancelar";printCancelButtonTextString.de="Abbrechen";printCancelButtonTextString.sl="prekini";printCancelButtonTextString.sk="Zruš";var objectIdentificationModeString=[];objectIdentificationModeString.topMostHit=[];objectIdentificationModeString.topMostHit.en="Topmost hit";objectIdentificationModeString.topMostHit.es="Capa superior";
objectIdentificationModeString.topMostHit.de="Oberster Treffer";objectIdentificationModeString.topMostHit.sl="zgornji zadetek";objectIdentificationModeString.topMostHit.sk="Najvyššia vrstva";objectIdentificationModeString.allLayers=[];objectIdentificationModeString.allLayers.en="All layers";objectIdentificationModeString.allLayers.es="Todas las capas";objectIdentificationModeString.allLayers.de="Alle Ebenen";objectIdentificationModeString.allLayers.sl="vsi sloji";
objectIdentificationModeString.allLayers.sk="Všetky vrstvy";objectIdentificationModeString.activeLayers=[];objectIdentificationModeString.activeLayers.en="Active Layer";objectIdentificationModeString.activeLayers.es="Capa activa";objectIdentificationModeString.activeLayers.de="Aktive Ebene";objectIdentificationModeString.activeLayers.sl="aktiven sloj";objectIdentificationModeString.activeLayers.sk="Aktívna vrstva";var measureDistanceResultPrefixString=[];measureDistanceResultPrefixString.en="Distance";
measureDistanceResultPrefixString.es="Distancia";measureDistanceResultPrefixString.de="Distanz";measureDistanceResultPrefixString.sl="razdalja";measureDistanceResultPrefixString.sk="Vzdialenosť";var measureAreaResultPrefixString=[];measureAreaResultPrefixString.en="Area";measureAreaResultPrefixString.es="Área";measureAreaResultPrefixString.de="Fläche";measureAreaResultPrefixString.sl="površina";measureAreaResultPrefixString.sk="Plocha";var zoomRectangleTooltipString=[];
zoomRectangleTooltipString.en="Zoom with rectangle";zoomRectangleTooltipString.es="Zoom con rectángulo";zoomRectangleTooltipString.de="Zoom Rechteck aufziehen";zoomRectangleTooltipString.sl="povečava s pravokotnikom";zoomRectangleTooltipString.sk="Priblíž výberom";var zoomFullViewTooltipString=[];zoomFullViewTooltipString.en="Zoom to the maximum map extent";zoomFullViewTooltipString.es="Zoom a la extensión máxima ";zoomFullViewTooltipString.de="Zoom zum maximalen Kartenausschnitt";
zoomFullViewTooltipString.sl="povečava na celotno območje";zoomFullViewTooltipString.sk="Celá mapa";var navigationHistoryBackwardTooltipString=[];navigationHistoryBackwardTooltipString.en="Navigation history backward";navigationHistoryBackwardTooltipString.es="Ir a la vista anterior";navigationHistoryBackwardTooltipString.de="Navigationshistorie zurück";navigationHistoryBackwardTooltipString.sl="prejšnji pogled";navigationHistoryBackwardTooltipString.sk="Predchádzajúci pohľad";
var navigationHistoryForwardTooltipString=[];navigationHistoryForwardTooltipString.en="Navigation history forward";navigationHistoryForwardTooltipString.es="Ir a la siguiente vista";navigationHistoryForwardTooltipString.de="Navigationshistorie vorwärts";navigationHistoryForwardTooltipString.sl="naslednji pogled";navigationHistoryForwardTooltipString.sk="Nasledujúci pohľad";var zoomInTooltipString=[];zoomInTooltipString.en="Zoom in (discrete step)";zoomInTooltipString.es="Acercar (un nivel)";
zoomInTooltipString.de="Einzoomen (eine Stufe)";zoomInTooltipString.sl="povečava (diskretni način)";zoomInTooltipString.sk="Priblíž jeden krok)";var zoomOutTooltipString=[];zoomOutTooltipString.en="Zoom out (discrete step)";zoomOutTooltipString.es="Alejar (un nivel)";zoomOutTooltipString.de="Rauszoomen (eine Stufe)";zoomOutTooltipString.sl="pomanjšava (diskretni način)";zoomOutTooltipString.sk="Oddiaľ jeden krok";var objIdentificationTooltipString=[];objIdentificationTooltipString.en="Object identification (attribute data)";
objIdentificationTooltipString.es="Indentificación de objetos (atributos)";objIdentificationTooltipString.de="Objektidentifizierung (Attributdaten)";objIdentificationTooltipString.sl="poizvedba (opisni podatki) na lokaciji";objIdentificationTooltipString.sk="Identifikácia objektu (atribúty)";var mapTipsTooltipString=[];mapTipsTooltipString.en="Display MapTips (attribute data)";mapTipsTooltipString.es="Desplegar textos emergentes (atributos)";mapTipsTooltipString.de="MapTips anzeigen (Attributdaten)";
mapTipsTooltipString.sl="Display MapTips (attribute data)";mapTipsTooltipString.sk="Zobraz MapTips";var measureDistanceTooltipString=[];measureDistanceTooltipString.en="Measure distance";measureDistanceTooltipString.es="Medir distancia";measureDistanceTooltipString.de="Distanz messen";measureDistanceTooltipString.sl="merjenje razdalje";measureDistanceTooltipString.sk="Odmeraj vzdialenosť";var measureAreaTooltipString=[];measureAreaTooltipString.en="Measure area";measureAreaTooltipString.es="Medir área";
measureAreaTooltipString.de="Fläche messen";measureAreaTooltipString.sl="merjenje površine";measureAreaTooltipString.sk="Odmeraj plochu";var printMapTooltipString=[];printMapTooltipString.en="Print Map";printMapTooltipString.es="Imprimir mapa";printMapTooltipString.de="Karte drucken";printMapTooltipString.sl="tiskanje karte";printMapTooltipString.sk="Vytlač mapu";var printMapDisabledTooltipString=[];printMapDisabledTooltipString.en="Print disabled, no layout is defined in the QGIS project";
printMapDisabledTooltipString.es="Imprimir deshabilitado, no hay formato definido en el proyecto de QGIS";printMapDisabledTooltipString.de="Drucken nicht möglich, da keine Layouts im QGIS-Projekt definiert wurden";printMapDisabledTooltipString.sl="Tiskanje onemogočeno, manjka 'layout' v QGIS projektu";printMapDisabledTooltipString.sk="Tlač nie je povolená";var sendPermalinkTooltipString=[];sendPermalinkTooltipString.en="Create permalink to current map";sendPermalinkTooltipString.es="Crear permalink al mapa actual";
sendPermalinkTooltipString.de="Create permalink to current map";sendPermalinkTooltipString.sl="povezava na trenutno karto";sendPermalinkTooltipString.sk="Vytvor odkaz na mapu";var sendPermalinkLinkFromString=[];sendPermalinkLinkFromString.en="Link to current map";sendPermalinkLinkFromString.es="Enlace al mapa actual";sendPermalinkLinkFromString.de="Link to current map";sendPermalinkLinkFromString.sl="Povezava do trenutne karte";sendPermalinkLinkFromString.sk="Odkaz na aktuálnu mapu";
var showHelpTooltipString=[];showHelpTooltipString.en="Show Help";showHelpTooltipString.es="Mostrar ayuda";showHelpTooltipString.de="Hilfe öffnen";showHelpTooltipString.sl="pomoč";showHelpTooltipString.sk="Ukáž pomoc";var showLocationTooltipString=[];showLocationTooltipString.en="Show Location";showLocationTooltipString.es="Mostrar localización";showLocationTooltipString.de="Show Location";showLocationTooltipString.sl="prikaz lokacije";showLocationTooltipString.sk="Ukáž polohu";
var geonamesLoadingString=[];geonamesLoadingString.en="Search...";geonamesLoadingString.es="Buscar...";geonamesLoadingString.de="Suche...";geonamesLoadingString.sl="iskanje poteka...";geonamesLoadingString.sk="Hľadám...";var geonamesEmptyString=[];geonamesEmptyString.en="Search location";geonamesEmptyString.es="Buscar lugar";geonamesEmptyString.de="Suche";geonamesEmptyString.sl="hitro iskanje";geonamesEmptyString.sk="Nájdi";var resetSearchFieldTooltipString=[];resetSearchFieldTooltipString.en="Reset/empty Searchfield";
resetSearchFieldTooltipString.es="Limpiar campo de búsqueda";resetSearchFieldTooltipString.de="Suchfeld zurücksetzen";resetSearchFieldTooltipString.sl="Ponastavi/izprazni iskalna polja";resetSearchFieldTooltipString.sk="Vyčisti pole";var printWindowTitleString=[];printWindowTitleString.en="The server is generating a PDF file. For correct up to scale printing please deactivate the option 'Fit to Page'!";printWindowTitleString.es="El servidor está generando un archivo PDF. Para corregir la escala de impresión desactive la opción 'Ajustar a la página'!";
printWindowTitleString.de="PDF wird vom Server generiert. Für massstäbliches Drucken deaktivieren Sie bitte das 'Anpassen der Seitengrösse'!";printWindowTitleString.sl="Priprava PDF dokumenta. Za izris v izbranem merilu je potrebno izklopiti opcijo 'Fit to Page'!";printWindowTitleString.sk="Server vytvára PDF súbor. Pre správne nastavenie mierky prosím odznačte voľbu 'Prispôsobiť - Fit to page'!";var printingObjectDataAlternativeString1=[];printingObjectDataAlternativeString1.en='It looks like your browser cannot open PDF files directly. Not a big problem - you can <a href="';
printingObjectDataAlternativeString1.es='Su navegador no puede abrir archivos PDF directamente. No es problema - usted puede <a href="';printingObjectDataAlternativeString1.de='Es sieht so aus als ob Ihr Browser kein PDF Plugin unterstützt. Kein Problem, Sie können die <a href="';printingObjectDataAlternativeString1.sl='Vaš brskalnik ne omogoča neposrednega prikaza PDF dokumentov, lahko pa - <a href="';printingObjectDataAlternativeString1.sk='Vyzerá to tak, že Váš prehlaidač nemá nainštalovaný PDF plugin. Nie je problém, môžete si <a href="';
var printingObjectDataAlternativeString2=[];printingObjectDataAlternativeString2.en='">download the PDF file here.</a>.</p></object>';printingObjectDataAlternativeString2.es='">descargar el archivo PDF aquí.</a>.</p></object>';printingObjectDataAlternativeString2.de='">PDF-Datei hier herunterladen</a>.</p></object>';printingObjectDataAlternativeString2.sl='">prevzamete PDF dokument tukaj.</a>.</p></object>';printingObjectDataAlternativeString2.sk='">PDF súbor stiahnuť tu</a>.</p></object>';
var printButtonTooltipString=[];printButtonTooltipString.en="Print (Generate PDF)";printButtonTooltipString.es="Imprimir (Generar PDF)";printButtonTooltipString.de="Drucken (PDF generieren)";printButtonTooltipString.sl="Tiskanje (PDF)";printButtonTooltipString.sk="Tlačiť ( Vytvoriť PDF)";var printCancelButtonTooltipString=[];printCancelButtonTooltipString.en="Cancel Print (Close)";printCancelButtonTooltipString.es="Cancelar impresión (Cerrar)";printCancelButtonTooltipString.de="Druck abbrechen (Schliesen)";
printCancelButtonTooltipString.en="Cancel Print (Close)";printCancelButtonTooltipString.sl="prekini tisk (zapri)";printCancelButtonTooltipString.sk="Zrušiť tlač (Zatvoriť)";var mapThemeButtonTooltipString=[];mapThemeButtonTooltipString.en="Click to choose a new map theme";mapThemeButtonTooltipString.es="Haga click para escoger un nuevo tema de mapa";mapThemeButtonTooltipString.de="Klicken Sie um das Kartenthema zu wechseln";mapThemeButtonTooltipString.sl="izbor vsebine";
mapThemeButtonTooltipString.sk="Klikni pre výber novej témy";var tooltipLayerTreeLayerOutsideScale=[];tooltipLayerTreeLayerOutsideScale.en="Visible at scales";tooltipLayerTreeLayerOutsideScale.es="Visible a las escalas";tooltipLayerTreeLayerOutsideScale.de="Sichtbar in den Massstäben";tooltipLayerTreeLayerOutsideScale.sl="vidno pri merilih";tooltipLayerTreeLayerOutsideScale.sk="Viditeľné v mierke";var clickPopupTitleString=[];clickPopupTitleString.en="Results";clickPopupTitleString.es="Resultados";
clickPopupTitleString.de="Results";clickPopupTitleString.sl="Rezultati poizvedbe";clickPopupTitleString.sk="Výsledky vyhľadávania";var contextZoomLayerExtent=[];contextZoomLayerExtent.en="Zoom to layer extent";contextZoomLayerExtent.es="Zoom a la extensión de la capa";contextZoomLayerExtent.de="Zoom to layer extent";contextZoomLayerExtent.sl="Povečava na območje sloja";contextZoomLayerExtent.sk="Priblíž na veľkosť vrstvy";var contextOpenTable=[];contextOpenTable.en="Open attribute table";
contextOpenTable.es="Abrir tabla de atributos";contextOpenTable.de="Open attribute table";contextOpenTable.sl="Prikaz opisnih podatkov sloja";contextOpenTable.sk="Otvor atribútovú tabuľku";var contextDataExport=[];contextDataExport.en="Export layer to...";contextDataExport.es="Exportar capa a...";contextDataExport.de="Export layer to...";contextDataExport.sl="Izvoz sloja v...";contextDataExport.sk="Exportuj vrstvu ako...";var contextUseExtent=[];contextUseExtent.en="Use current map extent";
contextUseExtent.es="Usar extensión del mapa actual";contextUseExtent.de="Use current map extent";contextUseExtent.sl="Uporabi trenutno območje";contextUseExtent.sk="Použi aktuálny rozsah mapy";var errMessageStartupMapParamString=[];errMessageStartupMapParamString.en="Startup-Parameter 'map' missing!";errMessageStartupMapParamString.es="Falta el parámetro de inicio 'map'!";errMessageStartupMapParamString.de="Start-Parameter 'map' fehlt!";errMessageStartupMapParamString.sl="Začetni parameter 'map' manjka!";
errMessageStartupMapParamString.sk="Chýba inicilaizačný parameter: 'map'!";var errMessageStartupNotAllParamsFoundString=[];errMessageStartupNotAllParamsFoundString.en="Some mandatory startup paramaters are missing or an optional startup parameter is invalid.";errMessageStartupNotAllParamsFoundString.es="Faltan algunos parámetros obligatorios";errMessageStartupNotAllParamsFoundString.de="Es wurden nicht alle notwendigen Web-GIS-Parameter gefunden oder ein optionaler Start-Parameter ist falsch.";
errMessageStartupNotAllParamsFoundString.sl="Obvezni začetni parametri manjkajo ali pa je podan nepravilni parameter.";errMessageStartupNotAllParamsFoundString.sk="Niektoré povinné parametre chýbajú alebo voliteľný parameter nie je správny.";var errMessageExtentParamWrongPart1=[];errMessageExtentParamWrongPart1.en="Start-parameter '";errMessageExtentParamWrongPart1.es="Parámetro de inicialización '";errMessageExtentParamWrongPart1.de="Start-Parameter '";errMessageExtentParamWrongPart1.sl="Začetni parameter '";
errMessageExtentParamWrongPart1.sk="Parameter '";var errMessageExtentParamWrongPart2=[];errMessageExtentParamWrongPart2.en="' needs to be in OpenLayers.Bounds format: 'left,bottom,right,top'.";errMessageExtentParamWrongPart2.es="' debe estar en formato OpenLayers.Bounds: 'left,bottom,right,top'.";errMessageExtentParamWrongPart2.de="' muss im OpenLayers.Bounds format sein: 'left,bottom,right,top'.";errMessageExtentParamWrongPart2.sl="' mora biti v 'OpenLayers.Bounds' formatu: 'left,bottom,right,top'.";
errMessageExtentParamWrongPart2.sk="'musí byť vo formáte OpenLayers.Bounds: 'left,bottom,right,top'.";var errMessageInvalidLanguageCodeString1=[];errMessageInvalidLanguageCodeString1.en="Invalid language code provided: ";errMessageInvalidLanguageCodeString1.es="El código de idioma es inválido: ";errMessageInvalidLanguageCodeString1.de="Falscher Sprachparameter übergeben: ";errMessageInvalidLanguageCodeString1.sl="Podana nepravilna koda jezika: ";errMessageInvalidLanguageCodeString1.sk="Nesprávny kód jazyka: ";
var errMessageInvalidLanguageCodeString2=[];errMessageInvalidLanguageCodeString2.en="Switching back to default language ";errMessageInvalidLanguageCodeString2.es="Restableciendo el idioma por defecto ";errMessageInvalidLanguageCodeString2.de="Wechsle zurück zur Standardsprache ";errMessageInvalidLanguageCodeString2.sl="Preklop na privzeti jezik ";errMessageInvalidLanguageCodeString2.sk="Prepínam späť na predvolený jazyk ";var errMessageSearchComboNetworkRequestFailureTitleString=[];
errMessageSearchComboNetworkRequestFailureTitleString.en="Network request failed";errMessageSearchComboNetworkRequestFailureTitleString.es="Falló la solicitud de red";errMessageSearchComboNetworkRequestFailureTitleString.de="Netzwerk-Request fehlgeschlagen";errMessageSearchComboNetworkRequestFailureTitleString.sl="Omrežni zahtevek ni uspel";errMessageSearchComboNetworkRequestFailureTitleString.sk="Sieťová požiadavka zlyhala";var errMessageSearchComboNetworkRequestFailureString=[];
errMessageSearchComboNetworkRequestFailureString.en="The network request for the geometry of the search result failed:\n";errMessageSearchComboNetworkRequestFailureString.es="Falló la solicitud de red para la geometría del resultado de la búsqueda:\n";errMessageSearchComboNetworkRequestFailureString.de="Netzwerk-Request für Geometrie des gesuchten Objekts fehlgeschlagen:\n";errMessageSearchComboNetworkRequestFailureString.sl="Omrežni zahtevek za geometrijo iskalnega rezultata ni uspel:\n";
errMessageSearchComboNetworkRequestFailureString.en="Zapytanie sieci o geometrię wyszukiwania nie powiodło się:\n";errMessageSearchComboNetworkRequestFailureString.sk="Sieťová požiadavka  pre geometriu vo výsledku hľadania zlyhala:\n";Ext.ns("Ext.ux.data");
Ext.ux.data.PagingStore=Ext.extend(Ext.data.Store,{add:function(a){a=[].concat(a);if(!(1>a.length)){for(var b=0,c=a.length;b<c;b++)a[b].join(this);b=this.data.length;this.data.addAll(a);this.allData&&this.allData.addAll(a);this.snapshot&&this.snapshot.addAll(a);this.totalLength+=a.length;this.fireEvent("add",this,a,b)}},remove:function(a){if(Ext.isArray(a))Ext.each(a,function(a){this.remove(a)},this);else if(this==a.store){a.join(null);var b=this.data.indexOf(a);-1<b&&this.data.removeAt(b);this.pruneModifiedRecords&&
this.modified.remove(a);this.allData&&this.allData.remove(a);this.snapshot&&this.snapshot.remove(a);this.totalLength--; -1<b&&this.fireEvent("remove",this,a,b)}},removeAll:function(a){var b=[].concat((this.snapshot||this.allData||this.data).items);this.clearData();this.pruneModifiedRecords&&(this.modified=[]);this.totalLength=0;!0!==a&&this.fireEvent("clear",this,b)},insert:function(a,b){b=[].concat(b);for(var c=0,d=b.length;c<d;c++)this.data.insert(a,b[c]),b[c].join(this);this.allData&&this.allData.addAll(b);
this.snapshot&&this.snapshot.addAll(b);this.totalLength+=b.length;this.fireEvent("add",this,b,a)},getById:function(a){return(this.snapshot||this.allData||this.data).key(a)},clearData:function(){this.allData&&(this.data=this.allData,delete this.allData);this.snapshot&&(this.data=this.snapshot,delete this.snapshot);this.data.each(function(a){a.join(null)});this.data.clear()},execute:function(a,b,c,d){if(!Ext.data.Api.isAction(a))throw new Ext.data.Api.Error("execute",a);c=Ext.applyIf(c||{},{params:{}});
void 0!==d&&this.addToBatch(d);var e=!0;"read"===a?(e=this.fireEvent("beforeload",this,c),Ext.applyIf(c.params,this.baseParams)):(!0===this.writer.listful&&!0!==this.restful?b=Ext.isArray(b)?b:[b]:Ext.isArray(b)&&1==b.length&&(b=b.shift()),!1!==(e=this.fireEvent("beforewrite",this,a,b,c))&&this.writer.apply(c.params,this.baseParams,a,b));if(!1!==e){this.writer&&this.proxy.url&&!this.proxy.restful&&!Ext.data.Api.hasUniqueUrl(this.proxy,a)&&(c.params.xaction=a);if("read"===a&&this.isPaging(Ext.apply({},
c.params)))return function(){this.allData&&(this.data=this.allData,delete this.allData);this.applyPaging();this.fireEvent("datachanged",this);var a=[].concat(this.data.items);this.fireEvent("load",this,a,c);c.callback&&c.callback.call(c.scope||this,a,c,!0)}.defer(1,this),!0;this.proxy.request(Ext.data.Api.actions[a],b,c.params,this.reader,this.createCallback(a,b,d),this,c)}return e},loadRecords:function(a,b,c){if(!0!==this.isDestroyed)if(a&&!1!==c){c=a.records;a=a.totalRecords||c.length;if(b&&!0===
b.add)this.totalLength=Math.max(a,this.data.length+c.length),this.add(c);else{this.pruneModifiedRecords&&(this.modified=[]);for(var d=0,e=c.length;d<e;d++)c[d].join(this);this.clearData();this.data.addAll(c);this.totalLength=a;this.applySort();this.allData||this.applyPaging();c.length>this.getCount()&&(c=[].concat(this.data.items));this.fireEvent("datachanged",this)}this.fireEvent("load",this,c,b);b.callback&&b.callback.call(b.scope||this,c,b,!0)}else!1!==c&&this.fireEvent("load",this,[],b),b.callback&&
b.callback.call(b.scope||this,[],b,!1,a)},loadData:function(a,b){this.isPaging(Ext.apply({},this.lastOptions?this.lastOptions.params:null,this.baseParams));var c=this.reader.readRecords(a);this.loadRecords(c,{add:b},!0)},getTotalCount:function(){return this.allData?this.allData.getCount():this.totalLength||0},sortData:function(){var a=this.hasMultiSort?this.multiSortInfo:this.sortInfo,b=a.direction||"ASC",c=a.sorters,d=[];this.hasMultiSort||(c=[{direction:b,field:a.field}]);for(var a=0,e=c.length;a<
e;a++)d.push(this.createSortFunction(c[a].field,c[a].direction));if(d.length){var g="DESC"==b.toUpperCase()?-1:1,c=function(a,b){var c=d[0].call(this,a,b);if(1<d.length)for(var e=1,m=d.length;e<m;e++)c=c||d[e].call(this,a,b);return g*c};this.allData&&(this.data=this.allData,delete this.allData);this.data.sort(b,c);this.snapshot&&this.snapshot!=this.data&&this.snapshot.sort(b,c);this.applyPaging()}},filterBy:function(a,b){this.snapshot=this.snapshot||this.allData||this.data;this.data=this.queryBy(a,
b||this);this.applyPaging();this.fireEvent("datachanged",this)},clearFilter:function(a){this.isFiltered()&&(this.data=this.snapshot,delete this.snapshot,delete this.allData,this.applyPaging(),!0!==a&&this.fireEvent("datachanged",this))},isFiltered:function(){return!!this.snapshot&&this.snapshot!=(this.allData||this.data)},queryBy:function(a,b){return(this.snapshot||this.allData||this.data).filterBy(a,b||this)},collect:function(a,b,c){c=(!0===c?this.snapshot||this.allData||this.data:this.data).items;
for(var d,e,g=[],f={},h=0,k=c.length;h<k;h++)d=c[h].data[a],e=String(d),!b&&Ext.isEmpty(d)||f[e]||(f[e]=!0,g[g.length]=d);return g},findInsertIndex:function(a){this.suspendEvents();var b=this.data.clone();this.data.add(a);this.applySort();a=this.data.indexOf(a);this.data=b;this.totalLength--;this.resumeEvents();return a},isPaging:function(a){var b=this.paramNames,c=a[b.start],d=a[b.limit];if("number"!=typeof c||"number"!=typeof d)return delete this.start,delete this.limit,this.lastParams=a,!1;this.start=
c;this.limit=d;delete a[b.start];delete a[b.limit];b=this.lastParams;this.lastParams=a;if(!this.proxy)return!0;if(!b)return!1;for(var e in a)if(a.hasOwnProperty(e)&&a[e]!==b[e])return!1;for(e in b)if(b.hasOwnProperty(e)&&a[e]!==b[e])return!1;return!0},applyPaging:function(){var a=this.start,b=this.limit;if("number"==typeof a&&"number"==typeof b){var c=this.data,d=new Ext.util.MixedCollection(c.allowFunctions,c.getKey);d.items=c.items.slice(a,a+b);d.keys=c.keys.slice(a,a+b);for(var a=d.length=d.items.length,
b={},e=0;e<a;e++){var g=d.items[e];b[d.getKey(g)]=g}d.map=b;this.allData=c;this.data=d}}});Ext.ux.data.PagingDirectStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:Ext.data.DirectStore.prototype.constructor});Ext.reg("pagingdirectstore",Ext.ux.data.PagingDirectStore);Ext.ux.data.PagingJsonStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:Ext.data.JsonStore.prototype.constructor});Ext.reg("pagingjsonstore",Ext.ux.data.PagingJsonStore);
Ext.ux.data.PagingXmlStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:Ext.data.XmlStore.prototype.constructor});Ext.reg("pagingxmlstore",Ext.ux.data.PagingXmlStore);Ext.ux.data.PagingArrayStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:Ext.data.ArrayStore.prototype.constructor,loadData:function(a,b){if(!0===this.expandData){for(var c=[],d=0,e=a.length;d<e;d++)c[c.length]=[a[d]];a=c}Ext.ux.data.PagingArrayStore.superclass.loadData.call(this,a,b)}});Ext.reg("pagingarraystore",Ext.ux.data.PagingArrayStore);
Ext.ux.data.PagingSimpleStore=Ext.ux.data.PagingArrayStore;Ext.reg("pagingsimplestore",Ext.ux.data.PagingSimpleStore);Ext.ux.data.PagingGroupingStore=Ext.extend(Ext.ux.data.PagingStore,Ext.copyTo({},Ext.data.GroupingStore.prototype,"constructor remoteGroup groupOnSort groupDir clearGrouping groupBy sort applyGroupField applyGrouping getGroupState".split(" ")));Ext.reg("paginggroupingstore",Ext.ux.data.PagingGroupingStore);
Ext.ux.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onLoad:function(a,b,c){this.rendered?(a=this.getParams(),this.cursor=c.params&&c.params[a.start]?c.params[a.start]:0,this.onChange()):this.dsLoaded=[a,b,c]},onChange:function(){var a=this.store.getTotalCount(),b=this.pageSize;this.cursor>=a&&(this.cursor=Math.ceil((a+1)/b)*b);var a=this.getPageData(),b=a.activePage,c=a.pages;this.afterTextItem.setText(String.format(this.afterPageText,a.pages));this.inputItem.setValue(b);this.first.setDisabled(1==
b);this.prev.setDisabled(1==b);this.next.setDisabled(b==c);this.last.setDisabled(b==c);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,a)},onClear:function(){this.cursor=0;this.onChange()},doRefresh:function(){delete this.store.lastParams;this.doLoad(this.cursor)},bindStore:function(a,b){var c;!b&&this.store&&(a!==this.store&&this.store.autoDestroy?this.store.destroy():(this.store.un("beforeload",this.beforeLoad,this),this.store.un("load",this.onLoad,this),this.store.un("exception",
this.onLoadError,this),this.store.un("datachanged",this.onChange,this),this.store.un("add",this.onChange,this),this.store.un("remove",this.onChange,this),this.store.un("clear",this.onClear,this)),a||(this.store=null));a&&(a=Ext.StoreMgr.lookup(a),a.on({scope:this,beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError,datachanged:this.onChange,add:this.onChange,remove:this.onChange,clear:this.onClear}),c=!0);this.store=a;if(c)this.onLoad(a,null,{})}});Ext.reg("ux.paging",Ext.ux.PagingToolbar);
Ext.ux.grid.RowNumberer=Ext.extend(Ext.grid.RowNumberer,{renderer:function(a,b,c,d){this.rowspan&&(b.cellAttr='rowspan="'+this.rowspan+'"');a=c.store;return a.lastOptions.params&&void 0!=a.lastOptions.params.start&&void 0!=a.lastOptions.params.limit?a.lastOptions.params.limit*Math.floor(a.lastOptions.params.start/a.lastOptions.params.limit)+d+1:d+1}});Ext.ux.grid.filter.NumericFilter&&Ext.apply(Ext.ux.grid.filter.NumericFilter.prototype,{menuItemCfgs:{emptyText:"",selectOnFocus:!0,width:125}});function makeLayer(a){if(null==a)return null;var b=Ext.util.JSON.decode(a.definition),c=a.title,d={};switch(a.type){case "Google":d=new OpenLayers.Layer.Google(c,b);break;case "OSM":d=new OpenLayers.Layer.OSM(c);break;case "XYZ":a=b.url.replace(/\/{/g,"/${");d=new OpenLayers.Layer.XYZ(c,a,b.options);break;case "Bing":d=new OpenLayers.Layer.Bing({name:c,type:b.imagerySet,key:b.key});break;case "WMTS":d=new OpenLayers.Layer.WMTS({name:c,url:b.url,layer:b.layer,requestEncoding:b.requestEncoding,matrixSet:b.matrixSet,
format:b.format,style:b.style,displayOutsideMaxExtent:!1,tileFullExtent:eval(b.tileFullExtent),tileOrigin:eval(b.tileOrigin),maxExtent:eval(b.maxExtent),zoomOffset:eval(b.zoomOffset),numZoomLevels:eval(b.numZoomLevels),maxResolution:eval(b.maxResolution),resolutions:eval(b.resolutions),serverResolutions:eval(b.serverResolutions)})}return d}
projectData.setBaseLayers=function(a){var b=[];a=a?projectData.baseLayers():projectData.extraLayers();if(null!=a)for(var c=0;c<a.length;c++)b.push(makeLayer(a[c]));0<b.length&&(enableBGMaps=!0);return b};
projectData.getLegendUrl=function(a){var b="";return b="gdal"==a.provider?iconDirectory+"raster.png":wmsURI+Ext.urlEncode({SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphics",FORMAT:"image/png",EXCEPTIONS:"application/vnd.ogc.se_inimage",BOXSPACE:1,LAYERSPACE:2,SYMBOLSPACE:1,SYMBOLHEIGHT:2,LAYERFONTSIZE:8,ITEMFONTSIZE:8,ICONLABELSPACE:2,LAYERTITLE:"FALSE",LAYERFONTCOLOR:"#FFFFFF",LAYERTITLESPACE:0,TRANSPARENT:!0,LAYERS:a.layername,DPI:screenDpi})};
var Eqwc={plugins:{}},lang="en",helpfile="help_en.html",customGetUrlParamsParser=null,serverAndCGI="/proxy",printServer=serverAndCGI,useGetProjectSettings=!0,showLayerOrderTab=!1,grayLayerNameWhenOutsideScale=!0,showMetaDataInLegend=!0,enableHoverPopup=!1,defaultIdentificationMode="allLayers",useGeodesicMeasurement=!0,useGeoCodeSearchBox=null!=projectData.geoCode,iconDirectory="client/site/gis_icons/",coordinatePrecision=2,elevationPrecision=1,minimumAddressRange=1E3,searchBoxQueryURL=null,searchBoxGetGeomURL=
null,autoActivateSearchGeometryLayer=!0,enablePermalink=!0,permaLinkURLShortener=null,enableBGMaps=!0,enableExtraLayers=!1,enableWmtsBaseLayers=!1,mediaurl="",suppressEmptyValues=!1,suppressInfoGeometry=!0,showFieldNamesInClickPopup=!0,showFeatureInfoLayerTitle=!0,noDataValue="",simpleWmsSearchMaxResults=10,tooltipTemplates={Country:{template:"Look for the country on Google Search: <a href='http://www.google.it/#output=search&q=<%name%>' target='_blank'><%name%></a>"}},mapSearchPanelOutputRegion=
"default",mapThemeSwitcherActive=!1,themeSwitcherTemplate=null,titleBarText=TR.appName,headerLogoImg=projectData.client_logo,headerLogoHeight=24,headerLogoLink=projectData.client_url,headerTermsOfUseText=TR.logoutLabel,headerTermsOfUseLink="./admin/login.php?action=logout",authid=projectData.crs,qgisLayerTransparency=!0,MapOptions={projection:new OpenLayers.Projection(authid),units:"m",numZoomLevels:22,fractionalZoom:!enableBGMaps,transitionEffect:"resize",zoomDuration:1,controls:[]},LayerOptions=
{buffer:0,singleTile:!0,ratio:1,transitionEffect:"resize",isBaseLayer:!1,projection:authid,displayOutsideMaxExtent:!0,tileOptions:{maxGetUrlLength:2048}},OverviewMapOptions={projection:new OpenLayers.Projection(authid),transitionEffect:"resize"},OverviewMapSize=new OpenLayers.Size(200,200),OverviewMapMaximized=!1,fixedPrintResolution=null,printCapabilities={scales:[{name:"1:100",value:"100"},{name:"1:200",value:"200"},{name:"1:250",value:"250"},{name:"1:500",value:"500"},{name:"1:1'000",value:"1000"},
{name:"1:2'000",value:"2000"},{name:"1:3'000",value:"3000"},{name:"1:5'000",value:"5000"},{name:"1:7'500",value:"7500"},{name:"1:10'000",value:"10000"},{name:"1:12'000",value:"12000"},{name:"1:15'000",value:"15000"},{name:"1:20'000",value:"20000"},{name:"1:25'000",value:"25000"},{name:"1:30'000",value:"30000"},{name:"1:50'000",value:"50000"},{name:"1:75'000",value:"75000"},{name:"1:100'000",value:"100000"},{name:"1:250'000",value:"250000"},{name:"1:500'000",value:"500000"},{name:"1:750'000",value:"750000"},
{name:"1:1'000'000",value:"1000000"},{name:"1:2'500'000",value:"2500000"},{name:"1:5'000'000",value:"5000000"},{name:"1:7'500'000",value:"7500000"},{name:"1:10'000'000",value:"10000000"},{name:"1:15'000'000",value:"15000000"},{name:"1:20'000'000",value:"20000000"},{name:"1:25'000'000",value:"25000000"},{name:"1:30'000'000",value:"30000000"},{name:"1:35'000'000",value:"35000000"},{name:"1:50'000'000",value:"50000000"},{name:"1:60'000'000",value:"60000000"},{name:"1:75'000'000",value:"75000000"},{name:"1:100'000'000",
value:"100000000"},{name:"1:125'000'000",value:"125000000"},{name:"1:150'000'000",value:"150000000"}],dpis:[{name:"150 dpi",value:"150"},{name:"300 dpi",value:"300"},{name:"600 dpi",value:"600"},{name:"1200 dpi",value:"1200"}],layouts:[]},symbolizersHighLightLayer={Point:{pointRadius:4,graphicName:"circle",fillColor:"none",strokeWidth:4,strokeColor:"#00FFFF"},Line:{strokeWidth:4,strokeOpacity:1,strokeColor:"#00FFFF"},Polygon:{strokeWidth:4,strokeColor:"#00FFFF",fillColor:"none"}},sketchSymbolizersMeasureControls=
{Point:{pointRadius:4,graphicName:"square",fillColor:"#FFFFFF",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#FF0000"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#FF0000",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#FF0000",fillColor:"#FFFFFF",fillOpacity:0.3}},locationAccuracyStyle={fillColor:"#000",fillOpacity:0.1,strokeWidth:0},locationMarkerStyle={graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,pointRadius:10};
OpenLayers.Renderer.symbol.arrow=[0,4,2,0,4,4,2,3,0,4];var projDef=CustomProj[authid];void 0!==projDef&&(OpenLayers.Projection.defaults[authid]={maxExtent:projDef.extent,yx:void 0!==projDef.yx?projDef.yx:!1});function customInit(){}
function customBeforeMapInit(){for(var a=projectData.tablesOnStart(),b=0;b<a.length;b++){var c=a[b],d=wmsLoader.layerTitleNameMapping[c],e=projectData.layers[d].wfs;0<=wmsLoader.projectSettings.capability.layerDrawingOrder.indexOf(d)&&(c=new QGIS.SearchPanel({useWmsRequest:!0,queryLayer:c,gridColumns:getLayerAttributes(c).columns,gridLocation:"bottom",gridTitle:c,gridResults:2E3,gridResultsPageSize:20,gridEditable:e,selectionLayer:c,formItems:[],doZoomToExtent:!0,tabClosable:!1}),c.onSubmit(),c.on("featureselectioncleared",
clearFeatureSelected),c.on("beforesearchdataloaded",showSearchPanelResults))}}
function customAfterMapInit(){layerTree.getNodeById("wmsNode").firstChild.cascade(function(a){if(a.isLeaf()&&a.attributes.checked){var b=wmsLoader.layerTitleNameMapping[a.text],b=projectData.getLegendUrl(void 0==projectData.layers[b]?{provider:"",layername:b}:projectData.layers[b]);Ext.DomHelper.insertAfter(a.getUI().getAnchor(),"<div id='legend_"+a.text.replace(" ","-")+"'><img style='vertical-align: middle; margin-left: 50px' src=\""+b+'"/></div>')}})}function customAfterGetMapUrls(){}
function customPostLoading(){}function customBeforePrint(){}function customAfterPrint(){}var customButtons=[];function customToolbarLoad(){Ext.iterate(Eqwc.plugins,function(a){this[a].customToolbarLoad()},Eqwc.plugins)}function customMapToolbarHandler(a,b){}
function customActionLayerTreeCheck(a){if(a.isLeaf())if(a.attributes.checked){if(!Ext.get("legend_"+a.text.replace(" ","-"))){var b=projectData.getLegendUrl(projectData.layers[wmsLoader.layerTitleNameMapping[a.text]]);Ext.DomHelper.insertAfter(a.getUI().getAnchor(),"<div id='legend_"+a.text.replace(" ","-")+"'><img style='vertical-align: middle; margin-left: 50px' src=\""+b+'"/></div>')}}else(a=Ext.get("legend_"+a.text.replace(" ","-")))&&a.remove()}function customActionOnZoomEvent(){}
function customActionOnMoveEvent(){};var urlParams={},urlParamsOK=!0,wmsURI,printURI,wmsMapName,maxExtent,olBoundsRegexp=/^-*[\d\.]+,-*[\d\.]+,-*[\d\.]+,-*[\d\.]+$/,urlString="",format="image/png",origFormat=format,searchtables=null,visibleLayers=null,visibleBackgroundLayer=null,initialLayerOrder=null,fullColorLayers=[];
if(customGetUrlParamsParser&&"function"===typeof customGetUrlParamsParser)customGetUrlParamsParser();else{var urlString=document.documentURI?document.documentURI:window.location.href,urlString=urlString.replace(/\+/g," "),urlArray=urlString.split("?"),norewrite;norewrite="cgi"===serverAndCGI.substr(serverAndCGI.length-3,3).toLowerCase()?!0:!1;if(!norewrite){var urlBaseArray=urlArray[0].split("/"),map=urlBaseArray.slice(4).join("/"),suffix="",dashpos=urlBaseArray[3].indexOf("-");-1!=dashpos&&(suffix=
urlBaseArray[3].substr(dashpos));wmsURI=serverAndCGI+suffix+"/"+map+"?";printURI=printServer+suffix+"/"+map+"?";wmsMapName=map}if(1<urlArray.length){urlParams=Ext.urlDecode(urlArray[1]);norewrite&&(void 0==urlParams.map?(alert(errMessageStartupMapParamString[lang]),urlParamsOK=!1):(wmsURI=serverAndCGI+"?map="+urlParams.map+"&",printURI=printServer+"?map="+urlParams.map+"&",wmsMapName=urlParams.map));null!=urlParams.visibleLayers&&(visibleLayers=""==urlParams.visibleLayers?[]:urlParams.visibleLayers.split(","));
enableBGMaps&&null!=urlParams.visibleBackgroundLayer&&(visibleBackgroundLayer=urlParams.visibleBackgroundLayer);null!=urlParams.initialLayerOrder&&""!=urlParams.initialLayerOrder&&(initialLayerOrder=urlParams.initialLayerOrder.split(","));null!=urlParams.fullColorLayers&&(fullColorLayers=""==urlParams.fullColorLayers?[]:urlParams.fullColorLayers.split(","));urlParams.format&&(format=urlParams.format);origFormat=format;"undefined"==typeof lang&&(lang="en");urlParams.lang&&(availableLanguages[urlParams.lang]?
lang=urlParams.lang:alert(errMessageInvalidLanguageCodeString1[lang]+"'"+urlParams.lang+"'\n"+errMessageInvalidLanguageCodeString2[lang]+availableLanguages[lang].names[lang]+"."));urlParams.searchtables&&(searchtables=urlParams.searchtables);if(urlParams.startExtent)if(urlParams.startExtent.match(olBoundsRegexp)){var startExtentParams=urlParams.startExtent.split(",");if(parseFloat(startExtentParams[0])>parseFloat(startExtentParams[2])||parseFloat(startExtentParams[1])>parseFloat(startExtentParams[3]))urlParamsOK=
!1}else urlParamsOK=!1,alert(errMessageExtentParamWrongPart1[lang]+"startExtent"+errMessageExtentParamWrongPart2[lang]);if(urlParams.maxExtent)if(urlParams.maxExtent.match(olBoundsRegexp)){var maxExtentParams=urlParams.maxExtent.split(",");parseFloat(maxExtentParams[0])>parseFloat(maxExtentParams[2])||parseFloat(maxExtentParams[1])>parseFloat(maxExtentParams[3])?urlParamsOK=!1:maxExtent=new OpenLayers.Bounds(parseFloat(maxExtentParams[0]),parseFloat(maxExtentParams[1]),parseFloat(maxExtentParams[2]),
parseFloat(maxExtentParams[3]))}else urlParamsOK=!1,alert(errMessageExtentParamWrongPart1[lang]+"maxExtent"+errMessageExtentParamWrongPart2[lang])}else urlParamsOK=!norewrite}customAfterGetMapUrls();Ext.tree.TriStateNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{onCheckChange:function(){Ext.tree.TriStateNodeUI.superclass.onCheckChange.apply(this,arguments);for(var a=this.node;(a=a.parentNode)&&a.getUI().updateParent&&a.getUI().checkbox&&!a.getUI().isUpdating;)a.getUI().updateParent()},toggleCheck:function(){var a=Ext.tree.TriStateNodeUI.superclass.toggleCheck.apply(this,arguments);this.updateChild(a);return a},renderElements:function(a,b,c,d){Ext.tree.TriStateNodeUI.superclass.renderElements.apply(this,
arguments);this.updateChild(this.node.attributes.checked)},updateParent:function(){var a;this.node.eachChild(function(b){if(void 0===a)a=b.attributes.checked;else if(a!==b.attributes.checked)return a=this.grayedValue,!1},this);this.toggleCheck(a)},updateChild:function(a){"boolean"==typeof a&&(this.isUpdating=!0,this.node.eachChild(function(b){b.getUI().toggleCheck(a)},this),delete this.isUpdating)}});
Ext.tree.AsynchTriStateNodeUI=Ext.extend(Ext.tree.TriStateNodeUI,{updateChild:function(a){this.checkbox&&(!0===a?Ext.fly(this.ctNode).replaceClass("x-tree-branch-unchecked","x-tree-branch-checked"):!1===a?Ext.fly(this.ctNode).replaceClass("x-tree-branch-checked","x-tree-branch-unchecked"):Ext.fly(this.ctNode).removeClass(["x-tree-branch-checked","x-tree-branch-unchecked"]))},getChecked:function(){var a=this.node.parentNode?this.node.parentNode.ui.getChecked():this.grayedValue;return"boolean"==typeof a?
a:Ext.tree.TriStateNodeUI.superclass.getChecked.call(this)}});
Ext.override(Ext.tree.TreeNodeUI,{grayedValue:null,onDisableChange:function(a,b){this.disabled=b;this[b?"addClass":"removeClass"]("x-tree-node-disabled")},initEvents:function(){this.node.on("move",this.onMove,this);this.node.disabled&&(this.disabled=!0,this.addClass("x-tree-node-disabled"));this.node.hidden&&this.hide();var a=this.node.getOwnerTree();!(a.enableDD||a.enableDrag||a.enableDrop)||this.node.isRoot&&!a.rootVisible||Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),
isHandle:!1})},onDblClick:function(a){a.preventDefault();this.disabled||(this.animating||!this.node.isExpandable()||a.getTarget(".x-tree-checkbox",1)||this.node.toggle(),this.fireEvent("dblclick",this.node,a))},onCheckChange:function(){var a=this.isChecked();a!==this.node.attributes.checked&&(this.node.attributes.checked=a,this.fireEvent("checkchange",this.node,a))},toggleCheck:function(a){var b=this.checkbox;if(!b)return!1;void 0===a&&(a=!1===this.isChecked());!0===a?Ext.fly(b).replaceClass("x-tree-node-grayed",
"x-tree-node-checked"):!1!==a?Ext.fly(b).replaceClass("x-tree-node-checked","x-tree-node-grayed"):Ext.fly(b).removeClass(["x-tree-node-checked","x-tree-node-grayed"]);this.onCheckChange();return a},onCheckboxClick:function(){this.disabled||this.toggleCheck();var a=null==this.node.attributes.checked?!1:!this.node.attributes.checked,b=!a;if(this.node.isLeaf())a?this.node.ownerTree.checkedLeafs.push(this.node):this.node.ownerTree.checkedLeafs.remove(this.node),null!=layerOrderPanel&&b!=layerOrderPanel.layerVisible(wmsLoader.layerTitleNameMapping[this.node.text])&&
layerOrderPanel.toggleLayerVisibility(wmsLoader.layerTitleNameMapping[this.node.text]),this.node.ownerTree.fireEvent("leafschange");else if(a&&!this.node.isExpanded())this.node.expand(!0,!1,function(a){a.cascade(function(a){a.isLeaf()&&null!=layerOrderPanel&&b!=layerOrderPanel.layerVisible(wmsLoader.layerTitleNameMapping[a.text])&&layerOrderPanel.toggleLayerVisibility(wmsLoader.layerTitleNameMapping[a.text])},this)}),this.node.ownerTree.fireEvent("leafschange"),this.node.collapse(!0,!1);else{var c=
0;this.node.cascade(function(a){a.isLeaf()&&null!=layerOrderPanel&&b!=layerOrderPanel.layerVisible(wmsLoader.layerTitleNameMapping[a.text])&&layerOrderPanel.toggleLayerVisibility(wmsLoader.layerTitleNameMapping[a.text]);c==this.node.childNodes.length&&this.node.ownerTree.fireEvent("leafschange");c++},this)}},onCheckboxOver:function(){this.addClass("x-tree-checkbox-over")},onCheckboxOut:function(){this.removeClass("x-tree-checkbox-over")},onCheckboxDown:function(){this.addClass("x-tree-checkbox-down")},
onCheckboxUp:function(){this.removeClass("x-tree-checkbox-down")},renderElements:function(a,b,c,d){this.indentMarkup=a.parentNode?a.parentNode.ui.getChildIndent():"";var e=void 0!==b.checked;b=['<li class="x-tree-node"><div ext:tree-node-id="',a.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',b.cls,'" unselectable="on"><span class="x-tree-node-indent">',this.indentMarkup,'</span><img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" /><img src="',b.icon||this.emptyIcon,'" class="x-tree-node-icon',
b.icon?" x-tree-node-inline-icon":"",b.iconCls?" "+b.iconCls:"",'" unselectable="on" />',e?'<img src="'+this.emptyIcon+'" class="x-tree-checkbox'+(!0===b.checked?" x-tree-node-checked":!1!==b.checked?" x-tree-node-grayed":"")+'" />':"",'<a hidefocus="on" class="x-tree-node-anchor" tabIndex="1" ',b.hrefTarget?' target="'+b.hrefTarget+'"':"",'><span unselectable="on">',a.text,'</span></a></div><ul class="x-tree-node-ct" style="display:none;"></ul></li>'].join("");var g;!0!==d&&a.nextSibling&&(g=a.nextSibling.ui.getEl())?
this.wrap=Ext.DomHelper.insertHtml("beforeBegin",g,b):this.wrap=Ext.DomHelper.insertHtml("beforeEnd",c,b);this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];a=this.elNode.childNodes;this.indentNode=a[0];this.ecNode=a[1];this.iconNode=a[2];c=3;e&&(this.checkbox=a[3],c++);this.anchor=a[c];this.textNode=a[c].firstChild},isChecked:function(){return this.checkbox?Ext.fly(this.checkbox).hasClass("x-tree-node-checked")?!0:Ext.fly(this.checkbox).hasClass("x-tree-node-grayed")?this.grayedValue:
!1:!1},getChecked:function(){return this.node.attributes.checked}});
Ext.override(Ext.tree.TreeEventModel,{initEvents:function(){var a=this.tree.getTreeEl();a.on("click",this.delegateClick,this);!1!==this.tree.trackMouseOver&&(a.on("mouseover",this.delegateOver,this),a.on("mouseout",this.delegateOut,this));a.on("mousedown",this.delegateDown,this);a.on("mouseup",this.delegateUp,this);a.on("dblclick",this.delegateDblClick,this);a.on("contextmenu",this.delegateContextMenu,this)},delegateOver:function(a,b){if(this.beforeEvent(a)&&(this.lastEcOver&&(this.onIconOut(a,this.lastEcOver),
delete this.lastEcOver),this.lastCbOver&&(this.onCheckboxOut(a,this.lastCbOver),delete this.lastCbOver),a.getTarget(".x-tree-ec-icon",1)?(this.lastEcOver=this.getNode(a),this.onIconOver(a,this.lastEcOver)):a.getTarget(".x-tree-checkbox",1)&&(this.lastCbOver=this.getNode(a),this.onCheckboxOver(a,this.lastCbOver)),this.getNodeTarget(a)))this.onNodeOver(a,this.getNode(a))},delegateOut:function(a,b){if(this.beforeEvent(a)){var c;a.getTarget(".x-tree-ec-icon",1)?(c=this.getNode(a),this.onIconOut(a,c),
c==this.lastEcOver&&delete this.lastEcOver):a.getTarget(".x-tree-checkbox",1)&&(c=this.getNode(a),this.onCheckboxOut(a,c),c==this.lastCbOver&&delete this.lastCbOver);if((b=this.getNodeTarget(a))&&!a.within(b,!0))this.onNodeOut(a,this.getNode(a))}},delegateDown:function(a,b){if(this.beforeEvent(a)&&a.getTarget(".x-tree-checkbox",1))this.onCheckboxDown(a,this.getNode(a))},delegateUp:function(a,b){if(this.beforeEvent(a)&&a.getTarget(".x-tree-checkbox",1))this.onCheckboxUp(a,this.getNode(a))},delegateClick:function(a,
b){if(this.beforeEvent(a))if(a.getTarget(".x-tree-checkbox",1))this.onCheckboxClick(a,this.getNode(a));else if(a.getTarget(".x-tree-ec-icon",1))this.onIconClick(a,this.getNode(a));else if(this.getNodeTarget(a))this.onNodeClick(a,this.getNode(a))},onCheckboxClick:function(a,b){b.ui.onCheckboxClick()},onCheckboxOver:function(a,b){b.ui.onCheckboxOver()},onCheckboxOut:function(a,b){b.ui.onCheckboxOut()},onCheckboxDown:function(a,b){b.ui.onCheckboxDown()},onCheckboxUp:function(a,b){b.ui.onCheckboxUp()}});
Ext.override(Ext.tree.TreePanel,{getChecked:function(a,b){b=b||this.root;var c=[];b.cascade(function(){this.ui.getChecked()&&c.push(a?"id"==a?this.id:this.attributes[a]:this)});return c}});objectIdentificationModes=Ext.extend(Ext.data.JsonStore,{constructor:function(a){a=a||{};objectIdentificationModes.superclass.constructor.call(this,Ext.apply({storeId:"objIdentificationModes",autoLoad:!0,data:{modes:[{name:objectIdentificationModeString.topMostHit[lang],value:"topMostHit"},{name:objectIdentificationModeString.allLayers[lang],value:"allLayers"},{name:objectIdentificationModeString.activeLayers[lang],value:"activeLayers"}]},root:"modes",fields:[{name:"name",type:"string",allowBlank:!1},
{name:"value",type:"string",allowBlank:!1}]},a))}});new objectIdentificationModes;var layoutHeaderCfg={tag:"div",cls:"x-panel-header",id:"panel_header",children:[{tag:"div",id:"panel_header_link",html:"<a></a>"},{tag:"div",id:"panel_header_title",html:"",style:{cursor:"default"}},{tag:"div",id:"panel_header_terms_of_use",html:"<a></a>"},{tag:"div",id:"panel_header_user",html:"<a></a>"+projectData.user+"&nbsp;"}]};null!=headerLogoImg&&(layoutHeaderCfg.style="height: "+headerLogoHeight+"px;");
MyViewportUi=Ext.extend(Ext.Viewport,{layout:"fit",initComponent:function(){this.items=[{xtype:"panel",layout:"border",id:"GisBrowserPanel",headerCfg:layoutHeaderCfg,items:[{xtype:"panel",margins:"3 0 3 3",cmargins:"3 3 3 3",title:leftPanelTitleString[lang],height:333,width:225,collapsible:!0,boxMinWidth:200,boxMaxWidth:400,layout:"vbox",region:"west",floatable:!1,minWidth:200,split:!0,collapseMode:"standard",id:"LeftPanel",items:[{xtype:"button",height:"1.5em",width:"100%",text:mapThemeButtonTitleString[lang],
id:"mapThemeButton",tooltip:mapThemeButtonTooltipString[lang],enableToggle:!1,allowDepress:!1,flex:0.1,hidden:!0},{xtype:"panel",layout:"accordion",border:!1,frame:!1,id:"collapsiblePanels",flex:0.9,width:"100%",layoutConfig:{titleCollapse:!0,animate:!0,activeOnTop:!1},activeItem:1,items:[{xtype:"panel",title:searchPanelTitleString[lang],id:"SearchPanel",border:!1,frame:!1,items:[{xtype:"tabpanel",enableTabScroll:!0,activeTab:0,id:"SearchTabPanel",items:[]}]},{xtype:"panel",title:layerTreeTitleString[lang],
layout:"border",id:"leftPanelMap",border:!1,frame:!1,items:[{xtype:"treepanel",lines:!1,border:!1,frame:!1,title:"",height:159,split:!0,region:"center",collapsible:!1,rootVisible:!1,autoScroll:!0,cls:"x-tree-noicon",id:"LayerTree",root:{text:"Root",expanded:!0,singleClickExpand:!0},loader:{}}]}]}]},{xtype:"panel",border:!1,frame:!1,margins:"3 3 3 0",flex:1,region:"center",width:100,layout:"border",id:"CenterPanel",items:[{xtype:"panel",region:"center",tpl:"",layout:"fit",id:"MapPanel",tbar:{xtype:"toolbar",
autoHeight:!0,id:"myTopToolbar",items:[{xtype:"tbseparator",id:"separator1"},{xtype:"button",tooltip:objIdentificationTooltipString[lang],toggleGroup:"mapTools",enableToggle:!0,icon:iconDirectory+"mActionIdentify.png",allowDepress:!0,tooltipType:"qtip",iconCls:"",scale:"medium",id:"IdentifyTool",hidden:!1},{xtype:"tbtext",text:objectIdentificationTextLabel[lang],id:"ObjectIdentificationText",hidden:!0},{xtype:"combo",width:120,store:"objIdentificationModes",valueField:"value",mode:"local",displayField:"name",
triggerAction:"all",id:"ObjectIdentificationModeCombo",hidden:!0},{xtype:"button",enableToggle:!0,allowDepress:!0,toggleGroup:"mapTools",icon:iconDirectory+"mActionMeasure.png",tooltip:measureDistanceTooltipString[lang],tooltipType:"qtip",scale:"medium",id:"measureDistance"},{xtype:"button",enableToggle:!0,allowDepress:!0,toggleGroup:"mapTools",scale:"medium",icon:iconDirectory+"mActionMeasureArea.png",tooltipType:"qtip",tooltip:measureAreaTooltipString[lang],id:"measureArea"},{xtype:"tbseparator",
id:"separator3"},{xtype:"button",enableToggle:!0,allowDepress:!0,toggleGroup:"mapTools",scale:"medium",icon:iconDirectory+"mActionFilePrint.png",tooltipType:"qtip",tooltip:printMapTooltipString[lang],id:"PrintMap"},{xtype:"button",enableToggle:!1,allowDepress:!1,scale:"medium",icon:iconDirectory+"mActionPermalink.png",tooltipType:"qtip",tooltip:sendPermalinkTooltipString[lang],id:"SendPermalink"},{xtype:"tbseparator",id:"separator4"}]},bbar:{xtype:"toolbar",id:"myBottomToolbar",items:[{xtype:"tbtext",
text:mapAppLoadingString[lang],id:"mainStatusText"},{xtype:"tbfill"},{xtype:"tbtext",text:"",id:"rightStatusText"},{xtype:"tbtext",text:coordinateTextLabel[lang]},{xtype:"tbspacer"},{xtype:"textfield",width:120,regex:/^\d{6}\.?\d{0,2},\d{6}\.?\d{0,2}$/,enableKeyEvents:!0,id:"CoordinateTextField"},{xtype:"tbtext",text:"1:"},{xtype:"numberfield",minValue:1,allowNegative:!1,allowDecimals:!1,width:65,enableKeyEvents:!0,id:"ScaleNumberField"}]}}]},{xtype:"panel",id:"RightPanel",title:"",region:"east",
split:!0,collapsible:!0,collapsed:!0,hidden:!0,width:300},{xtype:"tabpanel",id:"BottomPanel",title:"",region:"south",split:!0,collapsible:!0,collapsed:!0,hidden:!1,height:300,listeners:{tabchange:function(){0==this.items.getCount()&&this.collapse()}}}]}];this.items[0].items[1].items[0].tbar.items=this.items[0].items[1].items[0].tbar.items.concat(customButtons);MyViewportUi.superclass.initComponent.call(this)}});MyViewport=Ext.extend(MyViewportUi,{initComponent:function(){MyViewport.superclass.initComponent.call(this)}});
Ext.onReady(function(){Ext.QuickTips.init();(new MyViewport({renderTo:Ext.getBody()})).show()});window.QGIS||(window.QGIS={});QGIS.WMSCapabilitiesLoader=function(a){Ext.apply(this,a);QGIS.WMSCapabilitiesLoader.superclass.constructor.call(this,a)};
Ext.extend(QGIS.WMSCapabilitiesLoader,GeoExt.tree.WMSCapabilitiesLoader,{useGetProjectSettings:!0,WMSCapabilities:null,projectSettings:null,layerProperties:[],layerTitleNameMapping:[],initialVisibleLayers:[],getParams:function(a){return{SERVICE:"WMS",VERSION:"1.3",REQUEST:this.useGetProjectSettings?"GetProjectSettings":"GetCapabilities"}},processResponse:function(a,b,c,d){a.responseXML?this.WMSCapabilities=a.responseXML:window.DOMParser?this.WMSCapabilities=(new DOMParser).parseFromString(a.responseText,
"text/xml"):(this.WMSCapabilities=new ActiveXObject("Microsoft.XMLDOM"),this.WMSCapabilities.async="false",this.WMSCapabilities.loadXML(a.responseText));this.projectSettings=(new OpenLayers.Format.WMSCapabilities({readers:{wms:OpenLayers.Util.applyDefaults({ComposerTemplates:function(a,b){b.composerTemplates=[];this.readChildNodes(a,b.composerTemplates)},ComposerTemplate:function(a,b){var c={name:a.getAttribute("name"),width:parseInt(a.getAttribute("width")),height:parseInt(a.getAttribute("height"))};
this.readChildNodes(a,c);b.push(c)},ComposerMap:function(a,b){b.map={name:a.getAttribute("name"),width:parseInt(a.getAttribute("width")),height:parseInt(a.getAttribute("height"))}},ExclusiveLayerGroups:function(a,b){b.exclusiveLayerGroups=[];this.readChildNodes(a,b.exclusiveLayerGroups)},group:function(a,b){b.push(this.getChildValue(a).split(","))},LayerDrawingOrder:function(a,b){b.layerDrawingOrder=this.getChildValue(a).split(",")},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=
b;var e=a.getAttributeNode("queryable"),f=e&&e.specified?a.getAttribute("queryable"):null,g=(e=a.getAttributeNode("cascaded"))&&e.specified?a.getAttribute("cascaded"):null,q=(e=a.getAttributeNode("opaque"))&&e.specified?a.getAttribute("opaque"):null,t=(e=a.getAttributeNode("visible"))&&e.specified?a.getAttribute("visible"):null,u=a.getAttribute("displayField"),v=(e=a.getAttributeNode("checkbox"))&&e.specified?a.getAttribute("checkbox"):null,w=(e=a.getAttributeNode("legend"))&&e.specified?a.getAttribute("legend"):
null,e=(e=a.getAttributeNode("metadata"))&&e.specified?a.getAttribute("metadata"):null,y=a.getAttribute("noSubsets"),z=a.getAttribute("fixedWidth"),A=a.getAttribute("fixedHeight"),r=c||{},x=OpenLayers.Util.extend;c={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?x({},r.srs):{},metadataURLs:[],bbox:c?x({},r.bbox):{},llbbox:r.llbbox,dimensions:c?x({},r.dimensions):{},authorityURLs:c?x({},r.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&""!==f?"1"===f||"true"===f:r.queryable||!1,cascaded:null!==
g?parseInt(g):r.cascaded||0,opaque:q?"1"===q||"true"===q:r.opaque||!1,visible:t&&""!==t?"1"===t||"true"===t:!0,displayField:u,showCheckbox:v&&""!==v?"1"===v||"true"===v:!0,showLegend:w&&""!==w?"1"===w||"true"===w:!0,showMetadata:e&&""!==e?"1"===e||"true"===e:!0,noSubsets:null!==y?"1"===y||"true"===y:r.noSubsets||!1,fixedWidth:null!=z?parseInt(z):r.fixedWidth||0,fixedHeight:null!=A?parseInt(A):r.fixedHeight||0,minScale:r.minScale,maxScale:r.maxScale,attribution:r.attribution};c.capability=d;this.readChildNodes(a,
c);delete c.capability;b.nestedLayers.push(c);c.name&&(f=c.name.split(":"),g=d.request,q=g.getfeatureinfo,0<f.length&&(c.prefix=f[0]),d.layers.push(c),void 0===c.formats&&(c.formats=g.getmap.formats),void 0===c.infoFormats&&q&&(c.infoFormats=q.formats))},Attributes:function(a,b){b.attributes=[];this.readChildNodes(a,b.attributes)},Attribute:function(a,b){var c={name:validateFieldName(a.getAttribute("name"),a.getAttribute("alias")),type:a.getAttribute("type"),precision:parseInt(a.getAttribute("precision")),
length:parseInt(a.getAttribute("length")),editType:a.getAttribute("editType"),comment:a.getAttribute("comment")};b.push(c)},SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_3.prototype.readers.wms)}})).read(this.WMSCapabilities);this.processLayer(this.projectSettings.capability,this.projectSettings.capability.request.getmap.href,b);a=[];if(enableWmtsBaseLayers){var e=getWmtsLayersConfig(this.topicName||this.projectSettings.capability.nestedLayers[0].name);if(null!=
e)for(var g=0;g<e.length;g++)a.push(e[g].wmsLayerName);e=a.concat();for(g=0;g<this.projectSettings.capability.layerDrawingOrder.length;g++){var f=this.projectSettings.capability.layerDrawingOrder[g];-1==a.indexOf(f)&&e.push(f)}this.projectSettings.capability.layerDrawingOrder=e}for(g=0;g<this.projectSettings.capability.layers.length;g++)f=this.projectSettings.capability.layers[g],this.layerProperties[f.name]={name:f.name,title:f.title,"abstract":f["abstract"],visible:f.visible,opacity:255,queryable:f.queryable,
displayField:f.displayField,nrChildLayers:f.nestedLayers.length,attributes:f.attributes,srsList:f.srs,bbox:f.llbbox,minScale:null!=f.minScale?parseFloat(f.minScale):null,maxScale:null!=f.maxScale?parseFloat(f.maxScale):null,wmtsLayer:-1!=a.indexOf(f.name),showLegend:f.showLegend,showMetadata:f.showMetadata},this.layerTitleNameMapping[f.title]=f.name,f.visible&&this.initialVisibleLayers.push(f.name);void 0===this.projectSettings.capability.composerTemplates&&(this.projectSettings.capability.composerTemplates=
[]);void 0===this.projectSettings.capability.exclusiveLayerGroups&&(this.projectSettings.capability.exclusiveLayerGroups=[]);"function"==typeof c&&c.apply(d||b,[b])},createWMSLayer:function(a,b){return a.name?new OpenLayers.Layer.WMS(a.title,b,OpenLayers.Util.extend({formats:a.formats[0],layers:a.name},this.layerParams),OpenLayers.Util.extend({minScale:a.minScale,queryable:a.queryable,maxScale:a.maxScale,visible:a.visible,metadata:a},this.layerOptions)):null},findLayerNodeByName:function(a){a='//opengis:Layer/opengis:Name[text()="'+
a+'"]/..';var b=void 0;"function"==typeof this.WMSCapabilities.evaluate?(xpathResult=this.WMSCapabilities.evaluate(a,this.WMSCapabilities.firstChild,this.nsResolver,XPathResult.ANY_TYPE,null),4==xpathResult.resultType&&(b=xpathResult.iterateNext())):(this.WMSCapabilities.setProperty("SelectionLanguage","XPath"),this.WMSCapabilities.setProperty("SelectionNamespaces","xmlns:opengis='http://www.opengis.net/wms'"),b=this.WMSCapabilities.selectSingleNode(a));return b},nsResolver:function(a){return{opengis:"http://www.opengis.net/wms"}[a]||
null}});function validateFieldName(a,b){null!=b&&(a=b);var c="";return c=a.replace(/\./g,"")}QGIS.PrintProvider=function(a){Ext.apply(this,a);QGIS.PrintProvider.superclass.constructor.call(this,a)};
Ext.extend(QGIS.PrintProvider,GeoExt.data.PrintProvider,{print:function(a,b,c){a instanceof GeoExt.MapPanel&&(a=a.map);b=b instanceof Array?b:[b];c=c||{};if(!1!==this.fireEvent("beforeprint",this,a,b,c)){var d=printExtent.page.scale.get("value"),e=10;100<d&&250>=d?e=25:250<d&&1E3>=d?e=50:1E3<d&&2500>=d?e=100:2500<d&&5E3>=d?e=250:5E3<d&&12E3>=d?e=500:12E3<d&&25E3>=d?e=1E3:25E3<d&&5E4>=d?e=2E3:5E4<d&&1E5>=d?e=5E3:1E5<d&&5E5>=d?e=1E4:5E5<d&&1E6>=d?e=5E4:1E6<d&&5E6>=d?e=1E5:5E6<d&&1E7>=d?e=25E4:1E7<d&&
5E7>=d?e=25E5:5E7<d&&1E8>=d?e=5E6:1E8<d&&(e=1E7);printResolution=null!=fixedPrintResolution&&0<parseInt(fixedPrintResolution)?fixedPrintResolution:this.dpi.get("value");var g=thematicLayer.params.LAYERS;if(enableWmtsBaseLayers){for(var f=[],h=getWmtsLayers(),k=0;k<h.length;k++){var l=h[k];l.show&&f.push(l.wmsLayerName)}0<f.length&&(g=f.join(",")+","+g)}var m=this.url+"&SRS="+authid+"&DPI="+printResolution+"&TEMPLATE="+this.layout.get("name")+"&map0:extent="+printExtent.page.getPrintExtent(a).toBBOX(1,
!1)+"&map0:rotation="+-1*printExtent.page.rotation+"&map0:scale="+d+"&map0:grid_interval_x="+e+"&map0:grid_interval_y="+e+"&LAYERS="+encodeURIComponent(g);thematicLayer.params.OPACITIES&&(m+="&OPACITIES="+encodeURIComponent(thematicLayer.params.OPACITIES));d=printExtent.page.getPrintExtent(a).getCenterLonLat();d=new OpenLayers.Geometry.Point(d.lon,d.lat);d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Spatial.INTERSECTS,value:d});Ext.getBody().mask(printLoadingString[lang],"x-mask-loading");
d=new OpenLayers.Protocol.WFS({url:printURI,featureType:"print",geometryName:"geometry",srsName:authid,filter:d,readWithPOST:!0});this.fireEvent("afterprint",this,a,b,c);d.read({callback:function(a){try{if(null!=a.features&&0<a.features.length)for(key in attributes=a.features[0].attributes,attributes)m+="&"+key+"="+encodeURIComponent(attributes[key])}catch(b){}this.download(m)},scope:this})}},download:function(a){!1!==this.fireEvent("beforedownload",this,a)&&(Ext.getCmp("geoExtMapPanel"),(new Ext.Window({title:printWindowTitleString[lang],
width:Ext.getBody().getWidth()-100,height:Ext.getBody().getHeight()-100,resizable:!0,closable:!0,constrain:!0,constrainHeader:!0,x:50,y:50,html:'<object data="'+a+'" type="application/pdf" width="100%" height="100%"><p style="margin:5px;">'+printingObjectDataAlternativeString1[lang]+a+printingObjectDataAlternativeString2[lang]})).show(),Ext.getBody().unmask());this.fireEvent("print",this,a)}});
QGIS.SearchComboBox=Ext.extend(Ext.form.ComboBox,{map:null,highlightLayerName:null,highlightLayer:null,hasReverseAxisOrder:!1,url:null,geomUrl:null,hideTrigger:!1,minChars:2,queryDelay:50,displayField:"label",forceSelection:!0,searchtables:null,srs:null,initComponent:function(){this.emptyText=searchFieldDefaultTextString[lang];this.triggerConfig={tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-clear-trigger"};this.on("keyUp",this.keyUpHandler);this.on("afterrender",this.afterrenderHandler);
this.on("beforeselect",this.beforeselectHandler);this.store=new Ext.data.JsonStore({proxy:new Ext.data.ScriptTagProxy({url:this.url,method:"GET",callbackParam:"cb",nocache:!1,autoAbort:!0}),baseParams:{searchtables:this.getSearchTables(),srs:this.srs},root:"results",fields:"searchtable searchtext displaytext bbox showlayer selectable".split(" ")});this.tpl=(new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item {service}">','<tpl if="searchtable == null">',"<b>","</tpl>","{displaytext}",'<tpl if="searchtable == null">',
"</b>","</tpl>","</div></tpl>")).compile();QGIS.SearchComboBox.superclass.initComponent.call(this);this.highlightLayerName&&(this.highlightLayer=this.map.getLayersByName(this.highlightLayerName)[0]);this.on("select",this.recordSelected,this)},afterrenderHandler:function(){this.trigger.hide()},beforeselectHandler:function(a,b,c){"1"==b.get("selectable")&&this.collapse()},keyUpHandler:function(a,b){this.checkTrigger();Ext.isEmpty(this.getValue())&&this.resetSearch();this.getValue().length<this.minChars&&
this.collapse()},checkTrigger:function(){if(this.rendered)this.trigger[Ext.isEmpty(this.getValue())?"hide":"show"]()},onTriggerClick:function(){this.resetSearch();this.checkTrigger();this.focus()},onSelect:function(a,b){!1!==this.fireEvent("beforeselect",this,a,b)&&"1"==a.get("selectable")&&(this.setValue(a.get("displaytext")),this.fireEvent("select",this,a,b))},resetSearch:function(){this.collapse();this.clearSearchResult()},recordSelected:function(a,b,c){a=b.get("bbox");null!=a&&(a=OpenLayers.Bounds.fromArray(a,
this.hasReverseAxisOrder),this.map.zoomToExtent(a));this.highlightLayer&&Ext.Ajax.request({url:this.geomUrl,success:this.showSearchGeometry,failure:function(a,b){Ext.MessageBox.alert(errMessageSearchComboNetworkRequestFailureTitleString[lang],errMessageSearchComboNetworkRequestFailureString+a.responseText)},method:"GET",params:{searchtable:b.get("searchtable"),showlayer:b.get("showlayer"),searchtext:b.get("searchtext"),srs:this.srs}})},showSearchGeometry:function(a,b){var c=b.params.showlayer?b.params.showlayer:
b.params.searchtable;if("undefined"!=typeof autoActivateSearchGeometryLayer&&autoActivateSearchGeometryLayer&&-1!=allLayers.indexOf(c)){var d=!1;layerTree.root.cascade(function(a){a.text==c&&(d=a)});d&&(d.getUI().toggleCheck(!0),layerTree.fireEvent("leafschange"))}this.highlightLayer.removeAllFeatures();var e=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT(a.responseText));this.highlightLayer.addFeatures([e])},clearSearchResult:function(){this.setValue("");this.highlightLayer&&this.highlightLayer.removeAllFeatures()},
getSearchTables:function(){returnVal=null;null!=this.searchtables&&(returnVal=this.searchtables);return returnVal}});Ext.reg("qgis_searchcombo",QGIS.SearchComboBox);
QGIS.SearchPanel=Ext.extend(Ext.Panel,{form:null,featureInfoParser:null,store:null,resultsGrid:null,useWmsRequest:!1,wmsFilter:"",queryLayer:"",formItems:[],gridColumns:[],selectionLayer:"",selectionZoom:4,gridLocation:"",gridTitle:"",gridResults:100,gridResultsPageSize:20,gridEditable:!1,tabClosable:!0,constructor:function(a){a=a||{};a.useWmsRequest=a.useWmsRequest||!1;null==a.tabClosable&&(a.tabClosable=!0);null==a.gridEditable&&(a.gridEditable=!1);a.queryLayer=a.queryLayer||"";a.wmsFilter=a.wmsFilter||
"";a.formItems=a.formItems||[];a.gridColumns=a.gridColumns||[];a.gridLocation=a.gridLocation||"";a.gridTitle=a.gridTitle||"";null==a.gridResults&&(a.gridResults=100);null==a.gridResultsPageSize&&(a.gridResultsPageSize=20);a.selectionLayer=a.selectionLayer||"";null==a.selectionZoom&&(a.selectionZoom=4);this.addEvents(["beforesearchdataloaded","aftersearchdataloaded","searchformsubmitted"]);QGIS.SearchPanel.superclass.constructor.call(this,a)},initComponent:function(){this.form=new Ext.form.FormPanel({autoHeight:!0,
bodyBorder:!1,padding:3,defaults:{anchor:"-10"},items:this.formItems,buttons:[{text:searchButtonString[lang],scope:this,handler:this.onSubmit},{text:resetButtonString[lang],scope:this,handler:function(){this.fireEvent("featureselectioncleared");this.form.getForm().reset()}}],keys:[{key:[Ext.EventObject.ENTER],handler:function(){this.onSubmit()},scope:this}]});this.featureInfoParser=new QGIS.FeatureInfoParser;Ext.apply(this,{layout:"fit",autoHeight:!0,items:[this.form]});QGIS.SearchPanel.superclass.initComponent.call(this);
this.addEvents("featureselected");this.addEvents("featureselectioncleared")},onSubmit:function(){if(null===this.form||!1!==this.form.getForm().isValid()){null!==this.store&&this.store.removeAll();try{this.resultsGrid.hide()}catch(a){}this.fireEvent("featureselectioncleared");this.fireEvent("searchformsubmitted");var b=this;"bottom"==this.gridLocation&&(b=Ext.getCmp("BottomPanel"));b.show();b.collapsible&&b.expand();this.useWmsRequest?"BottomPanel"==b.id?void 0==Ext.getCmp("table_"+this.queryLayer)?
(this.submitGetFeatureInfo(),b.el.mask(pleaseWaitString[lang],"x-mask-loading")):b.activate(Ext.getCmp("table_"+this.queryLayer)):(this.submitGetFeatureInfo(),b.el.mask(pleaseWaitString[lang],"x-mask-loading")):this.submitForm()}},submitGetFeatureInfo:function(){var a=this.wmsFilter,b=wmsLoader.layerTitleNameMapping[this.queryLayer],c=!0;if(""==a){var a=[],d=this.form.getForm().getFieldValues(),e;for(e in d){var g=this.form.getForm().findField(e);if(d[e]){var f=g.initialConfig.filterOp?g.initialConfig.filterOp:
"=";valueQuotes=g.isXType("numberfield")?"":"'";valueExtra=-1<g.initialConfig.filterOp.indexOf("LIKE")?"%":"";a.push('"'+e+'" '+f+" "+valueQuotes+valueExtra+d[e]+valueExtra+valueQuotes);c&=g.validate()}}a=b+":"+a.join(" AND ")}else a=b+":"+a;c?Ext.Ajax.request({url:wmsURI,params:{SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetFeatureInfo",LAYERS:b,QUERY_LAYERS:b,FEATURE_COUNT:this.gridResults,INFO_FORMAT:"text/xml",SRS:authid,FILTER:a},method:"GET",scope:this,success:this.onSuccess,failure:this.onFormFailure}):
this.showFailure("client")},submitForm:function(){this.form.getForm().submit({url:wmsURI,method:"GET",scope:this,success:this.onFormSuccess,failure:this.onFormFailure})},onFormSuccess:function(a,b){this.onSuccess(b.response)},onSuccess:function(a){if(this.featureInfoParser.parseXML(a)){var b=this.featureInfoParser;a=b.featuresArray();var c=b.featureFields(),d=a.length,e=b.featuresBbox(),b=null==this.store&&0==a.length;if(null==this.store){var g=[];g.push({name:"feature_id"});for(var f=wmsLoader.layerProperties[wmsLoader.layerTitleNameMapping[this.queryLayer]].attributes,
h=0;h<f.length;h++){var k=f[h].type;"int"==k||"date"==k||"boolean"==k?g.push({name:f[h].name,type:k}):"double"==k?g.push({name:f[h].name,type:"float"}):g.push({name:f[h].name})}-1<c.indexOf("geometry")&&g.push({name:"geometry"});g.push({name:"bbox"});this.store=new Ext.ux.data.PagingArrayStore({idIndex:0,fields:g,lastOptions:{params:{start:0,limit:this.gridResultsPageSize}},totalCount:d,totalBbox:e,queryLayer:this.queryLayer,gridLocation:this.gridLocation,listeners:{datachanged:function(){if("bottom"==
this.gridLocation){var a=this.totalCount,b=this.getTotalCount(),c=Ext.getCmp("table_"+this.queryLayer);void 0!=c&&(b<a?c.setTitle(this.queryLayer+"* ("+b+")"):c.setTitle(this.queryLayer+" ("+a+")"))}}}})}else this.store.totalCount=d,this.store.totalBbox=e;this.fireEvent("beforesearchdataloaded",this,a);this.store.loadData(a,!1);a=this.el;"bottom"==this.gridLocation&&(a=Ext.getCmp("BottomPanel").el);a.unmask();b&&(this.store=null);this.fireEvent("aftersearchdataloaded",this)}else this.showFailure(this.featureInfoParser.serviceException())},
onFormFailure:function(a,b){if(null!=a&&200==a.status)this.onSuccess(a);else this.showFailure(a.statusText)},showFailure:function(a){var b=this.el;"bottom"==this.gridLocation&&(b=Ext.getCmp("BottomPanel").el);b.unmask();"client"==a?Ext.MessageBox.alert(searchPanelTitleString[lang],missingOrInvalidSearchParams[lang]):Ext.MessageBox.alert(searchErrorString[lang],a)},onRowClick:function(a,b,c){c=a.store.getAt(b);a=c.data.bbox;b=c.data.geometry;if(null!=a){c=c.id;var d=(a.minx+a.maxx)/2,e=(a.miny+a.maxy)/
2,g=!1;this.hasOwnProperty("doZoomToExtent")&&(g=this.doZoomToExtent);this.fireEvent("featureselected",{layer:this.selectionLayer,id:c,x:d,y:e,geometry:b,bbox:new OpenLayers.Bounds(a.minx,a.miny,a.maxx,a.maxy),zoom:this.selectionZoom,doZoomToExtent:g})}}});Ext.reg("qgis_searchpanel",QGIS.SearchPanel);
QGIS.FeatureInfoParser=Ext.extend(Object,{serviceExceptionMessage:"",fields:[],features:[],ids:[],bbox:null,parseXML:function(a){var b=null;a.responseXML?b=a.responseXML:window.DOMParser?b=(new DOMParser).parseFromString(a.responseText,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a.responseText));b=b.firstChild;if("ServiceExceptionReport"==b.nodeName)return a=b.getElementsByTagName("ServiceException")[0],this.serviceExceptionMessage=a.text||a.textContent,!1;if("GetFeatureInfoResponse"==
b.nodeName){this.fields=["feature_id"];a=!0;this.features=[];this.ids=[];var c=b.getElementsByTagName("BoundingBox")[0];this.bbox={minx:parseFloat(c.getAttribute("minx")),miny:parseFloat(c.getAttribute("miny")),maxx:parseFloat(c.getAttribute("maxx")),maxy:parseFloat(c.getAttribute("maxy"))};b=b.getElementsByTagName("Layer")[0];if(null!=b)for(var b=b.getElementsByTagName("Feature"),d=0;d<b.length;d++){var e=[],c=b[d],g=c.getAttribute("id");e.push(g);this.ids.push(g);for(var g=c.getElementsByTagName("Attribute"),
f=0;f<g.length;f++){var h=g[f];"maptip"!=h.getAttribute("name")&&(a&&this.fields.push(h.getAttribute("name")),e.push(h.getAttribute("value").replace("NULL",noDataValue)))}c=c.getElementsByTagName("BoundingBox");0<c.length&&(c=c[0],a&&this.fields.push("bbox"),e.push({minx:parseFloat(c.getAttribute("minx")),miny:parseFloat(c.getAttribute("miny")),maxx:parseFloat(c.getAttribute("maxx")),maxy:parseFloat(c.getAttribute("maxy"))}));a=!1;this.features.push(e)}return!0}this.serviceExceptionMessage="Error";
return!1},serviceException:function(){return this.serviceExceptionMessage},featureFields:function(){return this.fields},featuresArray:function(){return this.features},featureIds:function(){return this.ids},featuresBbox:function(){return this.bbox}});
Ext.override(Ext.ToolTip,{show:function(){this.anchor&&(this.showAt([-1E3,-1E3]),this.origConstrainPosition=this.constrainPosition,this.constrainPosition=!1,this.anchor=this.origAnchor);this.showAt(this.getTargetXY());this.anchor?(this.anchorEl.show(),this.syncAnchor(),this.constrainPosition=this.origConstrainPosition):this.anchorEl&&this.anchorEl.hide()},showAt:function(a){this.lastActive=new Date;this.clearTimers();Ext.ToolTip.superclass.showAt.call(this,a);this.dismissDelay&&!1!==this.autoHide&&
(this.dismissTimer=this.hide.defer(this.dismissDelay,this));this.anchor&&!this.anchorEl.isVisible()?(this.syncAnchor(),this.anchorEl.show()):this.anchorEl&&this.anchorEl.hide()}});
QGIS.LayerOrderPanel=Ext.extend(Ext.Panel,{title:null,store:null,grid:null,constructor:function(a){a=a||{};QGIS.LayerOrderPanel.superclass.constructor.call(this,a)},initComponent:function(){this.addEvents("layerVisibilityChange","orderchange","opacitychange");this.store=new Ext.data.ArrayStore({fields:[{name:"layer"}]});var a=this;this.grid=new Ext.grid.GridPanel({store:this.store,columns:[{id:"layer",header:"Ebene",dataIndex:"layer",renderer:function(b,c,d,e,g,f){b=d.get("layer");return b+"<el id='layerOrder_"+
a.escapeString(b)+"'></el>"}},{xtype:"actioncolumn",id:"actions",width:40,align:"right",items:[{iconCls:"action-icon action-down",tooltip:layerOrderPanelLayerSettingsTooltipString[lang],getClass:function(a,c,d){return"layerOptions_"+this.escapeString(d.get("layer"))},handler:function(a,c,d,e){c=this.escapeString(this.store.getAt(c).get("layer"));d=Ext.select("img.layerOptions_"+c).first();d.toggleClass("action-down");d.toggleClass("action-up");Ext.select("#opacitySlider_"+c).first().parent("tr").toggle();
this.resizeOpacitySlider(c,a.getWidth())},scope:this},{iconCls:"action-icon action-visible",tooltip:layerOrderPanelVisibilityChangeTooltipString[lang],getClass:function(a,c,d){return"layerOptions_"+this.escapeString(d.get("layer"))},handler:function(a,c,d){a=this.escapeString(this.store.getAt(c).get("layer"));a=Ext.select("img.layerOptions_"+a).first().next();a.toggleClass("action-visible");a.toggleClass("action-invisible");c=this.store.getAt(c);this.fireEvent("layerVisibilityChange",c.get("layer"))},
scope:this}]}],listeners:{resize:function(b,c,d,e,g){b.doLayout();b=this.getStore().getRange();for(d=0;d<b.length;d++)a.resizeOpacitySlider(a.escapeString(b[d].get("layer")),c)},render:function(b){new Ext.dd.DropTarget(b.container,{ddGroup:"layerorder",copy:!1,notifyDrop:function(c,e,g){var f=b.getStore(),h=b.getSelectionModel(),k=h.getSelections();if(c.getDragData(e)&&(c=c.getDragData(e).rowIndex,void 0!=c)){for(e=0;e<k.length;e++)f.remove(f.getById(k[e].id));f.insert(c,g.selections);h.clearSelections();
a.addOpacitySlider(g.selections[0].get("layer"));a.fireEvent("orderchange")}}});var c=b.getView().dragZone;c.addInvalidHandleClass("x-grid3-col-actions");c.addInvalidHandleClass("x-action-col-icon");c.addInvalidHandleClass("opacity-slider");c.addInvalidHandleClass("x-slider");c.addInvalidHandleClass("x-slider-end");c.addInvalidHandleClass("x-slider-inner");c.addInvalidHandleClass("x-slider-thumb");c.addInvalidHandleClass("x-slider-focus")}},ddGroup:"layerorder",ddText:layerOrderPanelMoveLayerTextString[lang],
enableDragDrop:!0,sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),hideHeaders:!0,autoExpandColumn:"layer",border:!1});Ext.apply(this,{layout:"fit",autoScroll:!0,border:!1,items:[this.grid]});QGIS.LayerOrderPanel.superclass.initComponent.call(this)},addLayer:function(a,b){var c=new this.store.recordType({layer:a},a);this.store.insert(0,c);this.addOpacitySlider(a);-1==visibleLayers.indexOf(a)&&this.toggleLayerVisibility(a)},clearLayers:function(){this.store.removeAll()},hasLayer:function(a){return void 0!=
this.store.getById(a)},toggleLayerVisibility:function(a){this.hasLayer(a)&&(a=this.escapeString(a),a=Ext.select("img.layerOptions_"+a).first().next(),a.toggleClass("action-visible"),a.toggleClass("action-invisible"))},layerVisible:function(a){var b=void 0;this.hasLayer(a)&&(b=this.escapeString(a),a=Ext.select("img.layerOptions_"+b).first().next(),b=!0,a.dom.className.match(/action-invisible/)&&(b=!1));return b},orderedLayers:function(){var a=[];this.store.each(function(b){a.push(b.get("layer"))});
return a.reverse()},addOpacitySlider:function(a){var b=this.escapeString(a),c="opacitySlider_"+b,d=Ext.DomHelper.insertAfter(Ext.select("tr:has(#layerOrder_"+b+")").first(),{tag:"tr",cls:"opacity-slider",children:[{tag:"td",colspan:2,id:c}]},!0);(new Ext.slider.SingleSlider({renderTo:c,id:"opacitySliderCmp_"+b,minValue:0,maxValue:255,value:wmsLoader.layerProperties[a].opacity,plugins:new Ext.slider.Tip({getText:function(a){return String.format(layerOrderPanelTransparencyTooltipString[lang],Math.round((255-
a.value)/255*100))}})})).on("changecomplete",function(b,c,d){this.fireEvent("opacitychange",a,c)},this);d.setVisibilityMode(Ext.Element.DISPLAY);d.hide()},resizeOpacitySlider:function(a,b){var c=Ext.ComponentMgr.get("opacitySliderCmp_"+a);c.getEl().parent("tr").isVisible()&&c.setWidth(b-19)},escapeString:function(a){return a.replace(/[^\w]/g,"_")}});Ext.reg("qgis_layerorderpanel",QGIS.LayerOrderPanel);
QGIS.LocationService=Ext.extend(Ext.util.Observable,{constructor:function(a){this.location=a.location;this.addEvents(["elevation","address"]);this.listeners=a.listeners;QGIS.LocationService.superclass.constructor.call(this,a)},locationToString:function(){return this.location.lon.toFixed(coordinatePrecision)+", "+this.location.lat.toFixed(coordinatePrecision)},locationToWgs:function(){return this.location.clone().transform(authid,new OpenLayers.Projection("EPSG:4326"))},getService:function(a){var b,
c,d,e,g,f,h;switch(a.name){case "elevation":switch(a.provider.toLowerCase()){case "mapbox":b="https://api.mapbox.com/v4/surface/mapbox.mapbox-terrain-v1.json";c="results";d="ele";e="<tr><td>{ele}m "+TR.fiElevation+"</td></tr>";g={layer:"contour",fields:"ele",points:this.locationToWgs().toShortString(),access_token:a.key};break;case "mapzen":b="https://elevation.mapzen.com/height",c="",d="height",e="<tr><td>{height}m "+TR.fiElevation+"</td></tr>",g={json:Ext.util.JSON.encode({range:!1,shape:[{lat:this.locationToWgs().lat,
lon:this.locationToWgs().lon}]}),api_key:a.key}}break;case "address":switch(a.provider.toLowerCase()){case "mapzen":b="https://search.mapzen.com/v1/reverse";c="features";d="properties";e="<tr><td>{label}  ("+measureDistanceResultPrefixString[lang].toLowerCase()+" {distance}m)</td></tr>";f="<tr><td>{region}, {country}</td></tr>";h=1E3;g={layers:"address","point.lat":this.locationToWgs().lat,"point.lon":this.locationToWgs().lon,api_key:a.key,size:1};break;case "mapbox":b="https://api.mapbox.com/geocoding/v5/mapbox.places/"+
this.locationToWgs().lon+","+this.locationToWgs().lat+".json",c="features",d="",e="<tr><td>{place_name}</td></tr>",f="",h=1,g={access_token:a.key,types:"address,neighborhood,place"}}}Ext.Ajax.request({url:b,params:g,method:"GET",scope:this,success:function(b){b=Ext.util.JSON.decode(b.responseText);0<b[c].length&&this.fireEvent(a.name,b[c][0],this.locationToString(),d,e,f,h)},failure:function(a){}})}});Ext.reg("qgis_location",QGIS.LocationService);
Ext.override(Ext.dd.DragTracker,{onMouseMove:function(a,b){var c=Ext.isIE6||Ext.isIE7||Ext.isIE8;if(this.active&&c&&!a.browserEvent.button)a.preventDefault(),this.onMouseUp(a);else{a.preventDefault();var c=a.getXY(),d=this.startXY;this.lastXY=c;if(!this.active)if(Math.abs(d[0]-c[0])>this.tolerance||Math.abs(d[1]-c[1])>this.tolerance)this.triggerStart(a);else return;this.fireEvent("mousemove",this,a);this.onDrag(a);this.fireEvent("drag",this,a)}}});Ext.namespace("GeoExt.ux");
GeoExt.ux.GeocodingSearchCombo=Ext.extend(Ext.form.ComboBox,{map:null,width:350,listWidth:350,zoom:8,minChars:1,queryDelay:50,maxRows:"20",tpl:'<tpl for="."><div class="x-combo-list-item">{'+this.displayField+"}</div></tpl>",countryString:"",sources:"",layers:"",hideTrigger:!0,displayField:"name",forceSelection:!0,queryParam:"text",url:"https://search.mapzen.com/v1/search?",initComponent:function(){GeoExt.ux.GeocodingSearchCombo.superclass.initComponent.apply(this,arguments);var a={size:this.maxRows,
layers:this.layers,api_key:this.key};"undefined"!==typeof this.countryString&&(a["boundary.country"]=this.countryString);"undefined"!==typeof this.sources&&(a.sources=this.sources);this.store=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.url,method:"GET"}),baseParams:a,reader:new Ext.data.JsonReader({idProperty:"properties.id",root:"features",fields:[{name:"id",mapping:"properties.id"},{name:"confidence",mapping:"properties.confidence"},{name:"country",mapping:"properties.country"},
{name:"region",mapping:"properties.region"},{name:"locality",mapping:"properties.locality"},{name:"street",mapping:"properties.street"},{name:"housenumber",mapping:"properties.housenumber"},{name:"postalcode",mapping:"properties.postalcode"},{name:"label",mapping:"properties.label"},{name:"lng",mapping:"geometry.coordinates[0]"},{name:"lat",mapping:"geometry.coordinates[1]"},{name:"name",mapping:"properties.name"},{name:"name2",convert:this.getName2}]})});if(0<this.zoom)this.on("select",function(a,
c,d){a=new OpenLayers.LonLat(c.data.lng,c.data.lat);a.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat),{},symbolizersHighLightLayer.Point);featureInfoHighlightLayer.removeAllFeatures();featureInfoHighlightLayer.addFeatures(c);this.map.setCenter(a,this.zoom)},this)},clearSearchResult:function(){this.setValue("");this.highlightLayer&&this.highlightLayer.removeAllFeatures();featureInfoHighlightLayer.removeAllFeatures()},
getName2:function(a,b){return b.properties.street+" "+b.properties.housenumber}});Ext.reg("gxux_GeocodingSearchCombo",GeoExt.ux.GeocodingSearchCombo);var featureInfoPopupContents,closePopupClick=!1;
function showFeatureInfo(a){removeClickPopup();if(identifyToolActive){if(closePopupClick)closePopupClick=!1;else{var b=geoExtMap.map;window.DOMParser?xmlDoc=(new DOMParser).parseFromString(a.text,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(a.text));var c="",d="";a=b.getLonLatFromPixel(a.xy);var e=new QGIS.LocationService({location:a}),g=[];if(null!=projectData.locationServices)for(c="</br>",d="<h2>"+TR.fiLocation+"</h2>",g.push({xtype:"box",html:d},
{id:"fi_location",xtype:"box",html:"<tr><td>"+e.locationToString()+"</td></tr>"}),d=0;d<projectData.locationServices.length;d++)e.getService({name:projectData.locationServices[d].name,key:projectData.locationServices[d].key,provider:projectData.locationServices[d].provider}),g.push({id:"fi_"+projectData.locationServices[d].name,xtype:"box",html:"</br>"});e.on("elevation",updateElevation);e.on("address",updateAddress);featureInfoResultLayers=[];highLightGeometry=[];parseFIResult(xmlDoc);featureInfoResultLayers.reverse();
highLightGeometry.reverse();if(0<featureInfoResultLayers.length||""<c){hoverPopup&&removeHoverPopup();clickPopup&&removeClickPopup();if("topMostHit"==identificationMode)c+=featureInfoResultLayers[0],featureInfoHighlightLayer.addFeatures(highLightGeometry[0]);else for(d=0;d<featureInfoResultLayers.length;d++)c+=featureInfoResultLayers[d],featureInfoHighlightLayer.addFeatures(highLightGeometry[d]);g.push({id:"fi_qgis",xtype:"box",html:c});clickPopup=new GeoExt.Popup({title:clickPopupTitleString[lang],
location:a,map:b,autoScroll:!0,bodyStyle:"padding:5px",items:g,maximizable:!0,collapsible:!0,listeners:{beforeshow:function(){var a=0.8*geoExtMap.getHeight();200<0.2*geoExtMap.getWidth()?this.setWidth(0.2*geoExtMap.getWidth()):this.setWidth(200);this.getHeight()>a&&this.setHeight(a)}}});clickPopup.show();changeCursorInMap("default")}}activateGetFeatureInfo(!0)}}
function showFeatureInfoHover(a){var b=geoExtMap.map;if(identifyToolActive){hoverPopup&&removeHoverPopup();window.DOMParser?xmlDoc=(new DOMParser).parseFromString(a.text,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(a.text));var c=xmlDoc.getElementsByTagName("Layer"),d="",e=!1,g=showFeatureInfoLayerTitle;mapThemeSwitcher&&void 0!=mapThemeSwitcher.activeProjectData&&(g=mapThemeSwitcher.activeProjectData.showFeatureInfoLayerTitle);for(var f=c.length-1;-1<
f;--f){for(var h=c[f].getElementsByTagName("Feature"),k=wmsLoader.layerProperties[c[f].getAttribute("name")].displayField||"tooltip",l=0;l<h.length;++l){0==l&&(g&&(d+='<h2 class="hoverLayerTitle">'+wmsLoader.layerProperties[c[f].getAttribute("name")].title+"</h2>"),e=!0);for(var m=h[l].getElementsByTagName("Attribute"),s={},n=0;n<m.length;++n)s[m[n].getAttribute("name")]=m[n].getAttribute("value");n=s.hasOwnProperty(k);m=s.hasOwnProperty("geometry");if(n)n=s[k],n.match(/</)?d+=n:(attribText="<p>"+
n.replace(/\n/,"<br/>"),attribText=attribText.replace("\n","<br/>"),d+=attribText+"</p>"),d+='<hr class="hrHoverLayer"/>';else if(tooltipTemplates&&tooltipTemplates.hasOwnProperty(c[f].getAttribute("name")))templateText=tooltipTemplates[c[f].getAttribute("name")].template,n=templateText.replace(/<%(\w*)%>/g,function(a,b){return(s.hasOwnProperty(b)?s[b]:"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),d+=n+"<br/>";else if(-1!==k.indexOf("[%")){for(var n=
k,p=RegExp(/\[%[^"]*"(.*?)"[^"]*%\]/g),q;q=p.exec(k);)var t=q[1],t=s.hasOwnProperty(t)?s[t]:"",n=n.replace(q[0],t);d+=n+"<br/>"}m&&(m=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT(s.geometry)),featureInfoHighlightLayer.addFeatures([m]))}h=[];for(l=c[f].firstChild;l;)"Attribute"==l.nodeName&&h.push(l),l=l.nextSibling;for(l=0;l<h.length;++l)0==l&&(g&&(d+='<h2 class="hoverLayerTitle">'+wmsLoader.layerProperties[c[f].getAttribute("name")].title+"</h2>"),e=!0),d+="<p>"+h[l].getAttribute("name")+
": "+h[l].getAttribute("value")+"</p>",d+='<hr class="hrHoverLayer"/>';if("topMostHit"==identificationMode&&e)break}e?(changeCursorInMap("pointer"),clickPopup||(d=d.replace(/<hr class="hrHoverLayer"\/>$/,""),hoverPopup=new OpenLayers.Popup.FramedCloud(null,b.getLonLatFromPixel(a.xy),null,d,null,!1,null),hoverPopup.autoSize=!0,hoverPopup.keepInMap=!0,hoverPopup.panMapIfOutOfView=!1,hoverPopup.events.on({click:onHoverPopupClick}),b.addPopup(hoverPopup))):changeCursorInMap("default")}}
function onBeforeGetFeatureInfoClick(a){0==selectedQueryableLayers.length&&(WMSGetFInfo.vendorParams.QUERY_LAYERS=a.object.layers[0].name,WMSGetFInfo.maxFeatures=0);activateGetFeatureInfo(!1)}function noFeatureInfoClick(a){activateGetFeatureInfo(!0)}function onHoverPopupClick(a){hoverPopup&&removeHoverPopup();var b=geoExtMap.map;a.xy=b.events.getMousePosition(a);b.events.triggerEvent("click",a)}
function onClickPopupClosed(a){removeClickPopup();enableHoverPopup&&WMSGetFInfoHover.activate();var b=geoExtMap.map;a.xy=b.events.getMousePosition(a);b.events.triggerEvent("mousemove",a);closePopupClick=!0}function removeClickPopup(){clickPopup&&clickPopup.destroy();clickPopup=null;featureInfoHighlightLayer.removeAllFeatures()}function removeHoverPopup(){geoExtMap.map.removePopup(hoverPopup);hoverPopup.destroy();hoverPopup=null;featureInfoHighlightLayer.removeAllFeatures()}
function showFeatureSelected(a){var b=wmsLoader.layerTitleNameMapping[a.layer];void 0==a.geometry?thematicLayer.mergeNewParams({SELECTION:b+":"+a.id}):(featureInfoHighlightLayer.removeAllFeatures(),b=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT(a.geometry)),featureInfoHighlightLayer.addFeatures([b]));a.doZoomToExtent?geoExtMap.map.zoomToExtent(a.bbox):geoExtMap.map.setCenter(new OpenLayers.LonLat(a.x,a.y),a.zoom)}
function clearFeatureSelected(){void 0!=thematicLayer.params.SELECTION&&thematicLayer.mergeNewParams({SELECTION:null});featureInfoHighlightLayer.removeAllFeatures()}
function parseFIResult(a){if(a.hasChildNodes()){var b=showFeatureInfoLayerTitle;mapThemeSwitcher&&void 0!=mapThemeSwitcher.activeProjectData&&(b=mapThemeSwitcher.activeProjectData.showFeatureInfoLayerTitle);if(a.hasChildNodes()&&"Layer"==a.nodeName){for(var c=!1,d=!1,e="",g=[],f=a.firstChild;f;){var h=wmsLoader.layerProperties[a.getAttribute("name")].title;if(f.hasChildNodes()&&"Feature"===f.nodeName){var k=f.firstChild;b&&(e+="<h2>"+h+"</h2>");for(e+="\n <p></p>\n <table>\n  <tbody>";k;){if("Attribute"==
k.nodeName){var h=k.getAttribute("name"),l=k.getAttribute("value").replace("NULL",noDataValue);if(h!==mapInfoFieldName&&(!0==suppressEmptyValues&&""!==l.replace(/^\s\s*/,"").replace(/\s\s*$/,"")||!1==suppressEmptyValues))if("geometry"===h){var m=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT(l));g.push(m);suppressInfoGeometry||(e+="\n   <tr>",showFieldNamesInClickPopup&&(e+="<td>"+h+":</td>"),e+="<td>"+l+"</td></tr>",c=!0)}else e+="\n   <tr>",showFieldNamesInClickPopup&&"maptip"!==h&&(e+=
"<td>"+h+":</td>"),""!=l&&/^((http|https|ftp):\/\/).+\..+/i.test(l)&&(/\<a./i.test(l)||(l='<a class="popupLink" href="'+l+'" target="_blank">'+l+"</a>")),""!=mediaurl&&RegExp(mediaurl,"i").test(l)&&(l='<a href="/'+l+'" target="_blank">'+l+"</a>"),e="maptip"==h?e+("<td colspan='2'>"+l+"</td></tr>"):e+("<td>"+l+"</td></tr>"),c=!0}k=k.nextSibling}e+="\n  </tbody>\n </table></br>"}else"Attribute"===f.nodeName&&(!1==d&&(e+="\n <p></p>\n <table>\n  <tbody>"),e+="\n<tr><td>"+f.getAttribute("name")+"</td><td>"+
f.getAttribute("value")+"</td></tr>",d=c=!0);f=f.nextSibling}c&&(d&&(e+="\n  </tbody>\n </table></br>"),featureInfoResultLayers.push(e),highLightGeometry.push(g))}else for(a=a.firstChild;a;)parseFIResult(a),a=a.nextSibling}}function listLayersWithFeatures(a){if(a.hasChildNodes())if("Layer"==a.nodeName)featureInfoResultLayers.push(a.getAttribute("name"));else for(a=a.firstChild;a;)listLayersWithFeatures(a),a=a.nextSibling}
function getFeatures(a,b){if(b.hasChildNodes()){if("Layer"==b.nodeName&&b.getAttribute("name")==a)return b.firstChild;for(var c=b.firstChild;c;)getFeatures(a,c),c=c.nextSibling}}function updateElevation(a,b,c,d){b=Ext.getCmp("fi_elevation");d=new Ext.Template(d);void 0===a||isNaN(a[c])||null===a[c]||(a[c]!==parseInt(a[c])&&(a[c]=a[c].toFixed(elevationPrecision)),a=d.apply(a),b.update(a))}
function updateAddress(a,b,c,d,e,g){b=Ext.getCmp("fi_address");var f=0;a=""==c||null==c?a:a[c];null!=a.distance&&(f=a.distance,a.distance=f*g);tem=f*g>minimumAddressRange?new Ext.Template(e):new Ext.Template(d);d=tem.apply(a);b.update(d)};function showLegendAndMetadata(a){var b=wmsLoader.layerTitleNameMapping[a];void 0==legendMetadataWindow&&setupLegendAndMetadataWindow();legendMetadataWindow.setTitle(legendMetadataWindowTitleString[lang]+' "'+a+'"');!1==legendMetadataWindow_active&&legendMetadataWindow.show();var c=projectData.layers[b],d=wmsURI+Ext.urlEncode({SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphics",FORMAT:"image/png",EXCEPTIONS:"application/vnd.ogc.se_inimage",BOXSPACE:1,LAYERSPACE:2,SYMBOLSPACE:1,SYMBOLHEIGHT:2,
LAYERFONTSIZE:8,ITEMFONTSIZE:8,LAYERS:b,DPI:screenDpi});legendMetaTabPanel=Ext.getCmp("legendMetaTabPanel");legendMetaTabPanel.activate(legendTab);legendTab.update('<img src="'+d+'" />');d={};void 0!=c&&(d=c.geom_type,""!=d||"ogr"!=c.provider&&"spatialite"!=c.provider||(d="vector"),""==d&&"gdal"==c.provider&&(d="raster"),d={TYPE:d,PROVIDER:c.provider,CRS:c.crs,IDENTIFY:wmsLoader.layerProperties[b].queryable,EDITABLE:c.wfs,ID:c.id});legendMetaTabPanel.activate(metadataTab);a='<style type="text/css">.even { background-color:rgb(240,240,240);border:none;} .mdCell {padding:0.3em;border:none;} .mdHeader {padding:0.3em;font-weight:bold;border:none;}</style>'+
('<div style="margin:1em;"><h1 style="margin-bottom:0.8em;">'+metadataSectionTitleString[lang]+' "'+a+'"</h1>');wmsLoader.layerProperties[b]["abstract"]&&(a+="<p><b>"+abstractString[lang]+"</b><p><p>"+wmsLoader.layerProperties[b]["abstract"]+"</p>");a+='<p style="margin-top:1em;margin-bottom:0.4em;font-weight:bold;">'+geographicExtentString[lang]+"</p><ul>";a+='<table style="margin-top:0.5em;border:none;border-collapse:collapse;"><tr class="even"><th class="mdHeader">'+westString[lang]+'</th><th class="mdHeader">'+
southString[lang]+'</th><th class="mdHeader">'+eastString[lang]+'</th><th class="mdHeader">'+northString[lang]+"</th></tr>";a+='<tr><td class="mdCell">'+wmsLoader.layerProperties[b].bbox[0]+'</td><td class="mdCell">'+wmsLoader.layerProperties[b].bbox[1]+'</td><td class="mdCell">'+wmsLoader.layerProperties[b].bbox[2]+'</td><td class="mdCell">'+wmsLoader.layerProperties[b].bbox[3]+"</td></tr>";a+="</table>";if(wmsLoader.layerProperties[b].attributes){a+='<p style="margin-top:1em"><b>'+attributesString[lang]+
'</b></p><table style="margin-top:0.5em;border:none;border-collapse:collapse;"><tr class="even"><th class="mdHeader">'+attributeNameString[lang]+'</th><th class="mdHeader">'+attributeTypeString[lang]+'</th><th class="mdHeader">'+attributeCommentString[lang]+'</th><th class="mdHeader">'+attributeLengthString[lang]+'</th><th class="mdHeader">'+attributePrecisionString[lang]+"</th></tr>";for(var c=1,e=0;e<wmsLoader.layerProperties[b].attributes.length;e++)attribute=wmsLoader.layerProperties[b].attributes[e],
a=0==c%2?a+'<tr class="even">':a+"<tr>",a+='<td class="mdCell">'+attribute.name+'</td><td class="mdCell">'+attribute.type+'</td><td class="mdCell">'+attribute.comment+'</td><td class="mdCell">'+attribute.length+'</td><td class="mdCell">'+attribute.precision+"</td></tr>",c++;a+="</table>"}a+="</div>";metadataTab.getComponent("propertyText").update(a);metadataTab.getComponent("propertyGrid").setSource(d);showMetaDataInLegend||legendMetaTabPanel.remove("metadataTab",!0)}
function setupLegendAndMetadataWindow(){legendMetadataWindow=new Ext.Window({title:legendMetadataWindowTitleString[lang],width:400,height:300,autoScroll:!0,maximizable:!0,layout:"fit",shadow:!1,items:[{xtype:"tabpanel",activeTab:0,defaults:{autoScroll:!0},id:"legendMetaTabPanel",items:[{title:metadataTabTitleString[lang],id:"metadataTab",items:[new Ext.grid.PropertyGrid({itemId:"propertyGrid",autoHeight:!0,stripeRows:!0,hideHeaders:!0,viewConfig:{forceFit:!0,scrollOffset:2},listeners:{beforeedit:function(a){return!1}}}),
new Ext.Container({itemId:"propertyText"})]},{title:legendTabTitleString[lang],id:"legendTab"}]}],listeners:{show:function(){legendMetadataWindow_active=!0},hide:function(){legendMetadataWindow_active=!1},close:function(){legendMetadataWindow=void 0}}});legendMetaTabPanel=Ext.getCmp("legendMetaTabPanel");legendTab=Ext.getCmp("legendTab");metadataTab=Ext.getCmp("metadataTab")};function buildGroupContextMenu(a){var b=[];b.push({text:contextZoomLayerExtent[lang],iconCls:"x-zoom-icon",handler:zoomToLayerExtent});b.push({text:TR.properties,handler:layerProperties});a.menu=new Ext.menu.Menu({items:b})}
function buildLayerContextMenu(a){var b=wmsLoader.layerTitleNameMapping[a.attributes.text],c=wmsLoader.layerProperties[b],b=projectData.layers[b],d=[];d.push({text:contextZoomLayerExtent[lang],iconCls:"x-zoom-icon",handler:zoomToLayerExtent});c.queryable&&"undefined"!==typeof c.attributes&&d.push({text:contextOpenTable[lang],iconCls:"x-table-icon",handler:openAttTable});void 0!=b&&"gdal"!==b.provider&&d.push({itemId:"contextExport",text:contextDataExport[lang],iconCls:"x-export-icon",menu:[{itemId:"SHP",
text:"ESRI Shapefile",handler:exportHandler},{itemId:"DXF",text:"AutoCAD DXF",handler:exportHandler},{itemId:"CSV",text:"Text CSV",handler:exportHandler},{itemId:"KML",text:"Keyhole Markup Language KML",handler:exportHandler},{itemId:"GeoJSON",text:"GeoJSON",handler:exportHandler},"-",{itemId:"currentExtent",text:contextUseExtent[lang],checked:!0,hideOnClick:!1}]});d.push({text:TR.properties,handler:layerProperties});c={items:d};b=[];if(null!=projectData.layerSpecifics)for(var d=projectData.layerSpecifics,
e=0,g=0;g<d.storedFilters.length;g++)d.storedFilters[g].layer==a.text&&(e++,1==e&&c.items.push({itemId:"mapFilter",text:d.storedFilters[g].menuTitle,checked:!1,hideOnClick:!0,menu:[],getFilter:function(){var a=null;this.menu.cascade(function(b){b.checked&&(a=b.value)});return a},listeners:{checkchange:function(){this.checked||(thematicLayer.params.FILTER="",thematicLayer.redraw(),this.menu.cascade(function(a){a.checked&&a.setChecked(!1)}));var b=Ext.getCmp("table_"+a.text);"object"==typeof b&&b.destroy()}}}),
c.items[c.items.length-1].menu.push({itemId:"storedFilter_"+e,text:d.storedFilters[g].title,value:d.storedFilters[g].filterValue,checked:!1,group:"storedFilters",handler:applyWMSFilter,listeners:{checkchange:function(){this.checked&&this.parentMenu.parentMenu.getComponent("mapFilter").setChecked(!0);var b=Ext.getCmp("table_"+a.text);"object"==typeof b&&b.destroy()}}}),b.push({text:d.storedFilters[g].title,value:d.storedFilters[g].filterValue}));a.menu=new Ext.menu.Menu(c);a.filter=b}
function zoomToLayerExtent(a){a=layerTree.getSelectionModel().getSelectedNode().text;a=(new OpenLayers.Bounds(wmsLoader.layerProperties[wmsLoader.layerTitleNameMapping[a]].bbox)).transform("EPSG:4326",geoExtMap.map.projection);geoExtMap.map.zoomToExtent(a)}function exportHandler(a){var b=layerTree.getSelectionModel().getSelectedNode().text,c=a.container.menuItemId;a=a.ownerCt.getComponent("currentExtent");exportData(b,c,a.checked)}
function layerProperties(a){a=layerTree.getSelectionModel().getSelectedNode().text;showLegendAndMetadata(a)}function contextMenuHandler(a){var b=a.menu.getComponent("contextExport");void 0!=b&&("guest"==projectData.user?b.setDisabled(!0):b.setDisabled(!1));a.select();a.menu.show(a.ui.getAnchor())}
function zoomHandler(a,b,c,d,e){c=a.getStore().getAt(b);d=c.id;e=a.itemId;a.getSelectionModel().selectRow(b);a=c.data.bbox;c.data.layer=e;c.data.doZoomToExtent=!0;c.data.id=d;c.data.bbox=OpenLayers.Bounds.fromArray([a.minx,a.miny,a.maxx,a.maxy]);showFeatureSelected(c.data)}
function exportData(a,b,c){var d=projectData.layers[wmsLoader.layerTitleNameMapping[a]].crs,e=null,g=null;c&&(e=geoExtMap.map.calculateBounds(),g=geoExtMap.map.calculateBounds().transform(authid,d));var f="./admin/export.php?"+Ext.urlEncode({map:projectData.project,SRS:authid,map0_extent:e,layer_extent:g,layer:a,format:b});Ext.Ajax.request({url:f,disableCaching:!1,params:{cmd:"prepare"},method:"GET",success:function(a){a=Ext.util.JSON.decode(a.responseText);a.success?(a=a.message,Ext.getBody().createChild({tag:"iframe",
cls:"x-hidden",id:"hiddenform-iframe",name:"iframe",src:f+"&cmd=get&key="+a})):Ext.Msg.alert("Error",a.message)},failure:function(a,b){Ext.Msg.alert("Error","server-side failure with status code "+a.status)}})}
function openAttTable(){var a=layerTree.getSelectionModel().getSelectedNode().text,b=wmsLoader.layerTitleNameMapping[a],b=projectData.use_ids?projectData.layers[b].wfs:!1,c=null,d=a;(d=this.parentMenu.getComponent("mapFilter"))&&(c=d.getFilter());d=a;a=new QGIS.SearchPanel({useWmsRequest:!0,wmsFilter:c,queryLayer:a,gridColumns:getLayerAttributes(a).columns,gridLocation:"bottom",gridEditable:b,gridTitle:d,gridResults:2E3,gridResultsPageSize:20,selectionLayer:a,formItems:[],doZoomToExtent:!0});a.onSubmit();
a.on("featureselectioncleared",clearFeatureSelected);a.on("beforesearchdataloaded",showSearchPanelResults)}function clearTableSelection(){this.ownerCt.ownerCt.getSelectionModel().clearSelections();clearFeatureSelected()}function applyWMSFilter(a){a=a.itemId.split("_")[1]-1;var b=layerTree.getSelectionModel().getSelectedNode();thematicLayer.params.FILTER=b.text+":"+b.filter[a].value;thematicLayer.redraw()}
function getLayerAttributes(a){var b=wmsLoader.layerTitleNameMapping[a];a={columns:[],fields:[]};for(var c=0;c<wmsLoader.layerProperties[b].attributes.length;c++){a.columns[c]={};var d=wmsLoader.layerProperties[b].attributes[c],e=d.type;"int"==e||"date"==e||"boolean"==e?a.fields.push({name:d.name,type:e}):"double"==e?a.fields.push({name:d.name,type:"float"}):a.fields.push({name:d.name,type:"string"});a.columns[c].header=d.name;a.columns[c].dataIndex=d.name;a.columns[c].menuDisabled=!1;a.columns[c].sortable=
!0;a.columns[c].filterable=!0;"double"==d.type&&(a.columns[c].xtype="numbercolumn",a.columns[c].format="0.000,00/i",a.columns[c].align="right");"int"==d.type&&(a.columns[c].xtype="numbercolumn",a.columns[c].format="000",a.columns[c].align="right")}b=getActionColumns(b);null!=b&&a.columns.unshift(b);a.columns.unshift(new Ext.ux.grid.RowNumberer({width:32}));return a}
function getActionColumns(a){return new Ext.grid.ActionColumn({width:22,items:[{icon:iconDirectory+"contextmenu/zoom.png",tooltip:TR.show,disabled:!1,handler:zoomHandler}]})};function loadWMSConfig(a){loadMask=new Ext.LoadMask(Ext.getCmp("MapPanel").body,{msg:mapLoadingString[lang]});loadMask.show();wmsLoader=new QGIS.WMSCapabilitiesLoader({url:wmsURI,useGetProjectSettings:useGetProjectSettings,layerOptions:{buffer:0,singleTile:!0,ratio:1},layerParams:{TRANSPARENT:"TRUE"},projectSettings:null,initialVisibleLayers:[],createNode:function(a){a.checked=!1;a.layer.metadata.showCheckbox||(a.cls="layer-checkbox-hidden");return QGIS.WMSCapabilitiesLoader.prototype.createNode.apply(this,
[a])},baseAttrs:{uiProvider:Ext.tree.TriStateNodeUI},topicName:a,listeners:{loadexception:function(a,c,d){exceptionLoading(d)}}});a=new Ext.tree.AsyncTreeNode({id:"wmsNode",text:"WMS",loader:wmsLoader,allowDrop:!1,expanded:!0,expandChildNodes:!0,listeners:{load:function(){postLoading()}}});layerTree.setRootNode(a)}
function postLoading(){function a(a){var b=wmsLoader.projectSettings.capability.layerDrawingOrder;if(null!=layerOrderPanel)if(enableWmtsBaseLayers){for(var c=layerOrderPanel.orderedLayers(),d=[],e=0;e<b.length;e++){var f=b[e];-1==c.indexOf(f)&&d.push(f)}b=d.concat(c)}else b=layerOrderPanel.orderedLayers();if(null!=b){c=[];for(e=0;e<b.length;e++)f=b[e],-1!=a.indexOf(f)&&c.push(f);return c}return a.reverse()}function b(a){for(var b=[],c=0;c<a.length;c++)b.push(wmsLoader.layerProperties[a[c]].opacity);
return b}layerTreeSelectionChangeHandlerFunction=function(a,b){themeChangeActive||layerTree.fireEvent("leafschange")};var c=0,d=projectData.setBaseLayers(!0),e=projectData.setBaseLayers(!1),g=makeLayer(projectData.overViewLayer());customBeforeMapInit();layerTree.selectPath(layerTree.root.firstChild.getPath());applyPermalinkParams();layerTree.suspendEvents();if(layerTree.root.hasChildNodes()){document.title=titleBarText+projectData.client_display_name;Ext.get("panel_header_title").update(document.title);
if(""<headerLogoLink){Ext.select("#panel_header_link a").replaceWith({tag:"a",href:headerLogoLink,target:"_blank",children:[{tag:"img",src:headerLogoImg,height:headerLogoHeight}]});Ext.get("panel_header_title").setStyle("padding-left","8px");var f=(headerLogoHeight-18)/2;Ext.get("panel_header_title").setStyle("padding-top",f+"px")}f=(headerLogoHeight-12)/2;Ext.select("#panel_header_user a").replaceWith({tag:"a",children:[{tag:"img",src:userLogoImg,height:14}]});Ext.get("panel_header_user").setStyle("padding-top",
f+"px");null!=headerTermsOfUseText&&(Ext.select("#panel_header_terms_of_use a").replaceWith({tag:"a",href:headerTermsOfUseLink,cls:"x-tool","ext:qtip":headerTermsOfUseText,target:"_self"}),null!=headerLogoImg&&Ext.get("panel_header_terms_of_use").setStyle("padding-top",f+"px"));null==visibleLayers&&(visibleLayers=a(wmsLoader.initialVisibleLayers));layerTree.root.firstChild.expand(!0,!1);layerTree.root.findChildBy(function(){this.isExpandable()&&this.expand(!0,!1);return!1},null,!0);for(var h=0;h<
visibleLayers.length;h++)layerTree.root.findChildBy(function(){wmsLoader.layerTitleNameMapping[this.attributes.text]==visibleLayers[h]&&this.getUI().toggleCheck(!0);return!1},null,!0);getVisibleFlatLayers(layerTree.root.firstChild);addAbstractToLayerGroups();layerTree.root.firstChild.collapseChildNodes(!0);layerTree.root.firstChild.expand(!1,!1)}layerTree.checkedLeafs=[];layerTree.resumeEvents();initialLoadDone||(Ext.getCmp("IdentifyTool").toggleHandler=mapToolbarHandler,Ext.getCmp("measureDistance").toggleHandler=
mapToolbarHandler,Ext.getCmp("measureArea").toggleHandler=mapToolbarHandler,Ext.getCmp("PrintMap").toggleHandler=mapToolbarHandler,"undefined"==typeof enablePermalink&&(enablePermalink=!0),enablePermalink?Ext.getCmp("SendPermalink").handler=mapToolbarHandler:Ext.getCmp("SendPermalink").destroy(),customToolbarLoad(),f=Ext.getCmp("ObjectIdentificationModeCombo"),f.setValue(defaultIdentificationMode),identificationMode=defaultIdentificationMode,f.on("select",function(a,b,c){identificationMode=b.get("value");
layerTree.fireEvent("leafschange")}));if(!1==maxExtent instanceof OpenLayers.Bounds){var k=OpenLayers.Projection.defaults[authid],f=void 0==k?!1:k.yx,k=wmsLoader.projectSettings.capability.nestedLayers[0].bbox[authid].bbox;void 0!=k&&(maxExtent=OpenLayers.Bounds.fromArray(k,f),enableWmtsBaseLayers||(MapOptions.maxExtent=maxExtent))}selectedLayers=[];selectedQueryableLayers=[];allLayers=[];var l=[];layerTree.root.firstChild.cascade(function(a){a.isLeaf()?(a.attributes.checked&&(wmsLoader.layerProperties[wmsLoader.layerTitleNameMapping[a.text]].wmtsLayer?
l.push(wmsLoader.layerTitleNameMapping[a.text]):selectedLayers.push(wmsLoader.layerTitleNameMapping[a.text]),wmsLoader.layerProperties[wmsLoader.layerTitleNameMapping[a.text]].queryable&&selectedQueryableLayers.push(wmsLoader.layerTitleNameMapping[a.text])),allLayers.push(wmsLoader.layerTitleNameMapping[a.text]),buildLayerContextMenu(a)):buildGroupContextMenu(a);a.on("contextMenu",contextMenuHandler)});mainStatusText.setText(mapLoadingString[lang]);format=imageFormatForLayers(selectedLayers);initialLoadDone&&
(printCapabilities.layouts=[]);k=wmsLoader.projectSettings.capability.composerTemplates;if(0<k.length)for(printLayoutsDefined=!0,f=0;f<k.length;f++){var m=k[f],s=m.map.width/ptTomm,n=m.map.height/ptTomm;printCapabilities.layouts.push({name:m.name,map:{width:s,height:n},size:{width:s,height:n},rotation:!0})}printUrl=printURI+"SERVICE=WMS&VERSION=1.3&REQUEST=GetPrint&FORMAT=pdf&EXCEPTIONS=application/vnd.ogc.se_inimage&TRANSPARENT=true";initialLoadDone?(printProvider.capabilities=printCapabilities,
printProvider.url=printUrl):(printProvider=new QGIS.PrintProvider({method:"GET",capabilities:printCapabilities,url:printUrl}),printProvider.addListener("beforeprint",customBeforePrint),printProvider.addListener("afterprint",customAfterPrint));printExtent?printExtent.printProvider=printProvider:printExtent=new GeoExt.plugins.PrintExtent({printProvider:printProvider});printExtent.initialized||(printExtent.initialized=!1);if(!initialLoadDone){f=new OpenLayers.Style;f.addRules([new OpenLayers.Rule({symbolizer:symbolizersHighLightLayer})]);
var p=new OpenLayers.StyleMap({"default":f})}f=Ext.getCmp("MapPanel");selectedLayers=a(selectedLayers);initialLoadDone?(geoExtMap.map.addLayers(d),thematicLayer.name=layerTree.root.firstChild.text,thematicLayer.url=wmsURI,thematicLayer.mergeNewParams({LAYERS:selectedLayers.join(","),OPACITIES:b(selectedLayers),FORMAT:format})):(MapOptions.fallThrough=!0,geoExtMap=new GeoExt.MapPanel({frame:!1,border:!1,zoom:1.6,layers:d.concat(e.concat([thematicLayer=new OpenLayers.Layer.WMS(layerTree.root.firstChild.text,
wmsURI,{layers:selectedLayers.join(","),opacities:b(selectedLayers),format:format,transparent:qgisLayerTransparency,dpi:screenDpi,VERSION:"1.3.0"},LayerOptions),highlightLayer=new OpenLayers.Layer.Vector("attribHighLight",{isBaseLayer:!1,styleMap:p}),featureInfoHighlightLayer=new OpenLayers.Layer.Vector("featureInfoHighlight",{isBaseLayer:!1,styleMap:p})])),map:MapOptions,id:"geoExtMapPanel",width:f.getInnerWidth(),height:f.getInnerHeight(),renderTo:f.body,plugins:[printExtent]}));initialLoadDone||
(k=geoExtMap.map.getProjectionObject(),rightStatusText.setText(k.getCode()),urlParams.startExtent&&(p=urlParams.startExtent.split(","),p=new OpenLayers.Bounds(parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),geoExtMap.map.zoomToExtent(p,!1)),f.on("resize",function(a,b,c){geoExtMap.setSize(a.getInnerWidth(),a.getInnerHeight())}),urlParams.selection&&thematicLayer.mergeNewParams({SELECTION:urlParams.selection}),geoExtMap.map.events.register("zoomend",this,function(){var a=geoExtMap.map.getScale();
Ext.getCmp("ScaleNumberField").setValue(Math.round(a));geoExtMap.map.zoomBoxActive&&Ext.getCmp("navZoomBoxButton").toggle(!1);customActionOnZoomEvent()}),geoExtMap.map.events.register("moveend",this,function(){customActionOnMoveEvent()}),geoExtMap.map.events.register("zoomend",this,this.setGrayNameWhenOutsideScale),thematicLayer.events.register("loadstart",this,function(){mapIsLoading=!0;setTimeout("displayLoadMask()",1E3)}),thematicLayer.events.register("loadend",this,function(){mapIsLoading=!1;
loadMask&&(loadMask.hide(),loadMask=null)}),f=Ext.getCmp("ScaleNumberField"),f.setValue(Math.round(geoExtMap.map.getScale())),f.on("change",function(a,b,c){Math.round(geoExtMap.map.getScale())!=b&&geoExtMap.map.zoomToScale(b,!0)}),f.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){var c=Math.round(geoExtMap.map.getScale()),d=a.getValue();c!=d&&geoExtMap.map.zoomToScale(d,!0)}36<b.getKey()&&41>b.getKey()&&b.stopPropagation()}),geoExtMap.map.addControl(new OpenLayers.Control.KeyboardDefaults),
geoExtMap.map.addControl(new OpenLayers.Control.Navigation),geoExtMap.map.addControl(new OpenLayers.Control.Attribution),geoExtMap.map.addControl(new OpenLayers.Control.ScaleLine),geoExtMap.map.addControl(new OpenLayers.Control.Zoom),coordinateTextField=Ext.getCmp("CoordinateTextField"),geoExtMap.map.events.register("mousemove",this,function(a){a=geoExtMap.map.events.getMousePosition(a);a=geoExtMap.map.getLonLatFromPixel(a);var b=0,c=geoExtMap.map.getScale();400>=c&&(b=1,100>=c&&(b=2));coordinateTextField.setRawValue(a.lon.toFixed(b)+
","+a.lat.toFixed(b))}),coordinateTextField.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){var c=a.getValue().split(","),c=new OpenLayers.LonLat(parseFloat(c[0]),parseFloat(c[1]));geoExtMap.map.setCenter(c)}36<b.getKey()&&41>b.getKey()&&b.stopPropagation()}),coordinateTextField.on("change",function(a,b,c){a=b.split(",");a=new OpenLayers.LonLat(parseFloat(a[0]),parseFloat(a[1]));geoExtMap.map.setCenter(a)}),navHistoryCtrl=new OpenLayers.Control.NavigationHistory,geoExtMap.map.addControl(navHistoryCtrl));
selectedQueryableLayers=a(selectedQueryableLayers);initialLoadDone&&(enableHoverPopup&&geoExtMap.map.removeControl(WMSGetFInfoHover),geoExtMap.map.removeControl(WMSGetFInfo));f=new OpenLayers.Layer.WMS(layerTree.root.firstChild.text,wmsURI,{layers:[],VERSION:"1.3.0"},LayerOptions);WMSGetFInfo=new OpenLayers.Control.WMSGetFeatureInfo({layers:[f],infoFormat:"text/xml",queryVisible:!0,vendorParams:{QUERY_LAYERS:selectedQueryableLayers.join(",")}});WMSGetFInfo.events.register("getfeatureinfo",this,showFeatureInfo);
WMSGetFInfo.events.register("beforegetfeatureinfo",this,onBeforeGetFeatureInfoClick);WMSGetFInfo.events.register("nogetfeatureinfo",this,noFeatureInfoClick);geoExtMap.map.addControl(WMSGetFInfo);enableHoverPopup&&(WMSGetFInfoHover=new OpenLayers.Control.WMSGetFeatureInfo({layers:[f],infoFormat:"text/xml",queryVisible:!0,hover:!0,vendorParams:{QUERY_LAYERS:selectedQueryableLayers.join(",")}}),WMSGetFInfoHover.events.register("getfeatureinfo",this,showFeatureInfoHover),geoExtMap.map.addControl(WMSGetFInfoHover));
initialLoadDone||null==g||(OverviewMapOptions.maxExtent=maxExtent,geoExtMap.map.addControl(new OpenLayers.Control.OverviewMap({size:OverviewMapSize,minRatio:16,maxRatio:64,mapOptions:OverviewMapOptions,maximized:OverviewMapMaximized,layers:[g]})));if(!initialLoadDone){Ext.getCmp("IdentifyTool").toggle(!0);identifyToolActive=!0;activateGetFeatureInfo(!0);g=Ext.getCmp("myTopToolbar");f=new Ext.Button({icon:iconDirectory+"mActionZoomFullExtent.png",id:"navZoomFullExtent",scale:"medium",map:geoExtMap.map,
tooltip:zoomFullViewTooltipString[lang],tooltipType:"qtip",handler:mapToolbarHandler});g.insert(0,f);f=new GeoExt.Action({icon:iconDirectory+"mActionZoomBox.png",id:"navZoomBoxButton",scale:"medium",control:new OpenLayers.Control.ZoomBox({out:!1}),map:geoExtMap.map,tooltip:zoomRectangleTooltipString[lang],tooltipType:"qtip",toggleGroup:"mapTools",enableToggle:!0,allowDepress:!0});g.insert(1,f);geoExtMap.map.zoomBoxActive=!1;Ext.getCmp("navZoomBoxButton").on("toggle",mapToolbarHandler);f=new GeoExt.Action({icon:iconDirectory+
"mActionZoomLast.png",scale:"medium",control:navHistoryCtrl.previous,disabled:!0,tooltip:navigationHistoryBackwardTooltipString[lang],tooltipType:"qtip",id:"zoomLast"});g.insert(2,f);f=new GeoExt.Action({icon:iconDirectory+"mActionZoomNext.png",scale:"medium",control:navHistoryCtrl.next,disabled:!0,tooltip:navigationHistoryForwardTooltipString[lang],tooltipType:"qtip",id:"zoomNext"});g.insert(3,f);var q=new GeoExt.Action({icon:iconDirectory+"mActionLocate.png",id:"geoLocate",scale:"medium",control:new OpenLayers.Control.Geolocate({bind:!1,
geolocationOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:7E3}}),map:geoExtMap.map,tooltip:showLocationTooltipString[lang],tooltipType:"qtip",enableToggle:!1,allowDepress:!0,handler:mapToolbarHandler});g.insert(13,q);var t=function(a){var b=a.geometry.getCentroid(),c=a.geometry.getBounds(),d=Math.abs((c.right-c.left)/2),e=0,f="up";window.resizeInterval=window.setInterval(function(){16<e&&clearInterval(window.resizeInterval);var c=0.03*d/d;switch(e){case 4:case 12:f="down";break;case 8:f="up"}"up"!==
f&&(c=-Math.abs(c));a.geometry.resize(1+c,b);featureInfoHighlightLayer.drawFeature(a);e++},50,b,d)};q.control.events.register("locationupdated",q.control,function(a){featureInfoHighlightLayer.removeAllFeatures();var b=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(a.point.x,a.point.y),a.position.coords.accuracy/2,40,0),{},locationAccuracyStyle);featureInfoHighlightLayer.addFeatures([new OpenLayers.Feature.Vector(a.point,{},locationMarkerStyle),
b]);geoExtMap.map.zoomToExtent(featureInfoHighlightLayer.getDataExtent());t(b);q.control.bind=!0});q.control.events.register("locationfailed",this,function(){Ext.Msg.alert("Error","Location detection failed");q.control.deactivate()});if(useGeoCodeSearchBox||null!=searchBoxQueryURL)g.insert(g.items.length,new Ext.Toolbar.Fill),useGeoCodeSearchBox?(qgisSearchCombo=new GeoExt.ux.GeocodingSearchCombo({map:geoExtMap.map,width:300,minChars:2,loadingText:geonamesLoadingString[lang],emptyText:geonamesEmptyString[lang],
lang:lang,zoom:projectData.geoCode.zoom,countryString:projectData.geoCode.countryString,tpl:'<tpl for="."><div class="x-combo-list-item"><h3>{name2}</h3>{postalcode} {locality}, {region}</div></tpl>',layers:projectData.geoCode.layers,sources:projectData.geoCode.sources,maxRows:10,displayField:"name2",key:projectData.geoCode.key}),f=new Ext.Button({scale:"medium",icon:iconDirectory+"mActionUndo.png",tooltipType:"qtip",tooltip:resetSearchFieldTooltipString[lang],id:"EmptySearchField"}),f.handler=mapToolbarHandler,
g.insert(g.items.length,f)):qgisSearchCombo=new QGIS.SearchComboBox({map:geoExtMap.map,highlightLayerName:"attribHighLight",hasReverseAxisOrder:!1,width:300,searchtables:searchtables,url:searchBoxQueryURL,geomUrl:searchBoxGetGeomURL,srs:3857}),g.insert(g.items.length,qgisSearchCombo);g.doLayout();!0==mapThemeSwitcherActive&&(mapThemeSwitcher=new ThemeSwitcher(Ext.getCmp("MapPanel")),Ext.getCmp("mapThemeButton").show());g=function(a){if("query"in urlParams){for(var b=null,c=0;c<a.length;c++)if(urlParams.query==
a[c].query){b=a[c];break}Ext.Ajax.request({url:wmsURI,params:urlParams,method:"GET",success:function(a){var c=new QGIS.FeatureInfoParser;c.parseXML(a)&&0<c.featureIds().length&&(thematicLayer.mergeNewParams({SELECTION:b.selectionLayer+":"+c.featureIds().join(",")}),a=c.featuresBbox(),geoExtMap.map.zoomToExtent(new OpenLayers.Bounds(a.minx,a.miny,a.maxx,a.maxy)),a=1.1*geoExtMap.map.getScale(),500>a&&(a=500),geoExtMap.map.zoomToScale(a))}})}};p=projectData.search;if(null!=p&&0<p.length){k=Ext.getCmp("SearchTabPanel");
for(f=0;f<p.length;f++)m=new QGIS.SearchPanel(p[f]),m.gridLocation="default",m.gridTitle=searchResultString[lang],m.gridResults=simpleWmsSearchMaxResults,m.on("featureselected",showFeatureSelected),m.on("featureselectioncleared",clearFeatureSelected),m.on("beforesearchdataloaded",showSearchPanelResults),k.add(m);k.setActiveTab(0);g(p)}else g=Ext.getCmp("SearchPanel"),g.removeAll(),g.hide();g=Ext.getCmp("LeftPanel");g.doLayout();g.addListener("resize",function(a,b,c,d,e){a.items.each(function(a,c,
d){a.width=b});a.doLayout()});g=new OpenLayers.Style;g.addRules([new OpenLayers.Rule({symbolizer:sketchSymbolizersMeasureControls})]);g=new OpenLayers.StyleMap({"default":g});measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,handlerOptions:{layerOptions:{styleMap:g}}}),polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,handlerOptions:{layerOptions:{styleMap:g}}})};for(var u in measureControls)g=measureControls[u],g.events.on({measure:handleMeasurements,
measurepartial:handleMeasurements}),g.setImmediate(!0),g.geodesic=useGeodesicMeasurement,geoExtMap.map.addControl(g)}leafsChangeFunction=function(){selectedLayers=[];selectedQueryableLayers=[];layerTree.root.firstChild.cascade(function(a){a.isLeaf()&&a.attributes.checked&&(selectedLayers.push(wmsLoader.layerTitleNameMapping[a.text]),wmsLoader.layerProperties[wmsLoader.layerTitleNameMapping[a.text]].queryable&&selectedQueryableLayers.push(wmsLoader.layerTitleNameMapping[a.text]));customActionLayerTreeCheck(a)});
format=imageFormatForLayers(selectedLayers);selectedLayers=a(selectedLayers);selectedQueryableLayers=a(selectedQueryableLayers);if("activeLayers"==identificationMode){var c=[],d=[];layerTree.getSelectionModel().getSelectedNode().cascade(function(a){a.isLeaf()&&a.attributes.checked&&(c.push(a.text),wmsLoader.layerProperties[a.text].queryable&&d.push(a.text))});c=a(c);d=a(d)}thematicLayer.mergeNewParams({LAYERS:selectedLayers.join(","),OPACITIES:b(selectedLayers),FORMAT:format});"activeLayers"!=identificationMode?
(WMSGetFInfo.vendorParams={QUERY_LAYERS:selectedQueryableLayers.join(",")},enableHoverPopup&&(WMSGetFInfoHover.vendorParams={QUERY_LAYERS:selectedQueryableLayers.join(",")})):(WMSGetFInfo.vendorParams={QUERY_LAYERS:d.join(",")},enableHoverPopup&&(WMSGetFInfoHover.vendorParams={QUERY_LAYERS:d.join(",")}));if(enableBGMaps){var e=[],f=null;layerTree.root.lastChild.cascade(function(a){a.isLeaf()&&a.attributes.checked&&e.push(a)});1==e.length?f=e[0].layer.name:2==e.length&&(layerTree.removeListener("leafschange",
leafsChangeFunction),layerTree.root.lastChild.cascade(function(a){a.isLeaf()&&a.attributes.checked&&(a.layer.name==currentlyVisibleBaseLayer?(a.unselect(),a.layer.setVisibility(!1)):f=a.layer.name)}),layerTree.addListener("leafschange",leafsChangeFunction));currentlyVisibleBaseLayer=f}};initialLoadDone&&layerTree.removeListener("leafschange",leafsChangeFunction);layerTree.addListener("leafschange",leafsChangeFunction);if(enableExtraLayers)for(u=new Ext.tree.TreeNode({leaf:!1,expanded:!0,text:externalLayerTitleString[lang]}),
layerTree.root.appendChild(u),u.on("contextMenu",Ext.emptyFn,null,{preventDefault:!0}),g=0;g<e.length;g++)f=new GeoExt.tree.LayerNode({layer:e[g],leaf:!0,checked:!1,uiProvider:Ext.tree.TriStateNodeUI}),u.appendChild(f),f.on("contextMenu",Ext.emptyFn,null,{preventDefault:!0});if(enableBGMaps){e=new Ext.tree.TreeNode({leaf:!1,expanded:!0,text:backgroundLayerTitleString[lang]});layerTree.root.appendChild(e);e.on("contextMenu",Ext.emptyFn,null,{preventDefault:!0});if(null!=visibleBackgroundLayer)for(c=
-1,f=0;f<d.length;f++)if(d[f].name==visibleBackgroundLayer){c=f;break}for(f=0;f<d.length;f++)d[f].setVisibility(f==c),u=new GeoExt.tree.LayerNode({layer:d[f],leaf:!0,checked:f==c,uiProvider:Ext.tree.TriStateNodeUI}),f==c&&(currentlyVisibleBaseLayer=d[f].name),e.appendChild(u),u.on("contextMenu",Ext.emptyFn,null,{preventDefault:!0})}initialLoadDone?(printLayoutsCombobox=Ext.getCmp("PrintLayoutsCombobox"),printLayoutsCombobox.store.removeAll(),printLayoutsCombobox.store.loadData(printCapabilities)):
!0==printLayoutsDefined&&(printWindow=new Ext.Window({title:printSettingsToolbarTitleString[lang],height:67,width:530,layout:"fit",renderTo:"geoExtMapPanel",resizable:!1,closable:!1,x:50,y:10,items:[{tbar:{xtype:"toolbar",autoHeight:!0,id:"myPrintToolbar",items:[{xtype:"combo",id:"PrintLayoutsCombobox",width:100,mode:"local",triggerAction:"all",readonly:!0,store:new Ext.data.JsonStore({data:printCapabilities,storeId:"printLayoutsStore",root:"layouts",fields:[{name:"name",type:"string"},"map","size",
"rotation"]}),valueField:"name",displayField:"name",listeners:{select:function(a,b,c){printProvider.setLayout(b)}}},{xtype:"tbspacer"},{xtype:"combo",id:"PrintScaleCombobox",width:95,mode:"local",triggerAction:"all",store:new Ext.data.JsonStore({data:printCapabilities,storeId:"printScalesStore",root:"scales",fields:[{name:"name",type:"string"},{name:"value",type:"int"}]}),valueField:"value",displayField:"name",listeners:{select:function(a,b,c){printExtent.page.setScale(b)}}},{xtype:"tbspacer"},{xtype:"combo",
id:"PrintDPICombobox",width:70,mode:"local",triggerAction:"all",store:new Ext.data.JsonStore({data:printCapabilities,storeId:"printDPIStore",root:"dpis",fields:[{name:"name",type:"string"},{name:"value",type:"int"}]}),valueField:"value",displayField:"name",listeners:{select:function(a,b,c){printProvider.setDpi(b)}}},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"label",text:printSettingsRotationTextlabelString[lang]},{xtype:"tbspacer"},{xtype:"spinnerfield",id:"PrintLayoutRotation",width:60,value:0,
allowNegative:!0,autoStripChars:!0,allowDecimals:!1,minValue:-360,maxValue:360,enableKeyEvents:!0,listeners:{spin:function(){printExtent.page.setRotation(Ext.getCmp("PrintLayoutRotation").getValue(),!0)},keyup:function(a,b){printExtent.page.setRotation(Ext.getCmp("PrintLayoutRotation").getValue(),!0);b.stopPropagation()},keydown:function(a,b){b.stopPropagation()},keypress:function(a,b){b.stopPropagation()}}},{xtype:"tbspacer"},{xtype:"button",tooltip:printButtonTooltipString[lang],text:printButtonTextString[lang],
tooltipType:"qtip",iconCls:"",scale:"medium",id:"StartPrinting",listeners:{click:function(){Ext.getCmp("PrintMap").toggle(!1);printProvider.print(geoExtMap,[printExtent.page])}}},{xtype:"button",tooltip:printCancelButtonTooltipString[lang],text:printCancelButtonTextString[lang],tooltipType:"qtip",iconCls:"",scale:"medium",id:"CancelPrinting",listeners:{click:function(){Ext.getCmp("PrintMap").toggle(!1)}}}]}}]}));!1==printLayoutsDefined?(c=Ext.getCmp("PrintMap"),c.disable(),c.setTooltip(printMapDisabledTooltipString[lang])):
(printLayoutsCombobox=Ext.getCmp("PrintLayoutsCombobox"),printLayoutsCombobox.setValue(printLayoutsCombobox.store.getAt(0).data.name),c=Ext.getCmp("PrintDPICombobox"),c.setValue("300"),c.fireEvent("select",c,c.findRecord(c.valueField,"300")),null!=fixedPrintResolution&&0<parseInt(fixedPrintResolution)&&(c.hide(),printWindow.setWidth(printWindow.width-80)),printWindow.show(),printWindow.hide());printExtent.hide();initialLoadDone&&(identifyToolWasActive&&(identifyToolWasActive=!1,Ext.getCmp("IdentifyTool").toggle(!0)),
themeChangeActive=!1);layerTree.getSelectionModel().addListener("selectionChange",layerTreeSelectionChangeHandlerFunction);loadMask&&loadMask.hide();initialLoadDone=!0;setGrayNameWhenOutsideScale();customAfterMapInit()}
function showSearchPanelResults(a,b){if(b.length){var c=null,d=!0,e=!0,g="";switch(a.gridLocation){case "right":c=Ext.getCmp("RightPanel");g="SearchPanelResultsGrid";break;case "bottom":c=Ext.getCmp("BottomPanel");g="table_"+a.queryLayer;e=d=!1;break;case "popup":"undefined"==typeof Ext.getCmp("SearchResultsPopUp")&&(c=new Ext.Window({id:"SearchResultsPopUp",layout:"fit",width:"80%",height:300,modal:!1,closeAction:"hide"}));d=e=!1;c=Ext.getCmp("SearchResultsPopUp");break;default:d=!1,c=a}try{Ext.getCmp("SearchPanelResultsGrid").destroy()}catch(f){}var h=
new Ext.ux.grid.GridFilters({encode:!1,local:!0,menuFilterText:TR.menuFilterText}),k={};a.gridResults>a.gridResultsPageSize&&(k=new Ext.ux.PagingToolbar({pageSize:a.gridResultsPageSize,store:a.store,displayInfo:!1}));var l=a.gridTitle+" ("+a.store.totalCount+")";""<a.wmsFilter&&(l+=" ["+a.wmsFilter+"]");var m=!1;5>a.gridColumns.length&&(m=!0);a.resultsGrid=new Ext.grid.GridPanel({id:g,title:l,itemId:a.gridTitle,closable:a.tabClosable,collapsible:d,collapsed:!1,store:a.store,columns:a.gridColumns,
plugins:[h],sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),autoHeight:e,viewConfig:{forceFit:m},bbar:k,listeners:{render:function(a){a.store.on("load",function(c,d,e){1==b.length&&(a.getSelectionModel().selectFirstRow(),a.fireEvent("rowClick",a,0))})},filterupdate:function(){if("object"===typeof a.resultsGrid){var b=[],c=wmsLoader.layerTitleNameMapping[a.queryLayer],d=Ext.decode(Ext.encode(a.resultsGrid.filters.getFilterData()));Ext.each(d,function(a){if("string"==a.data.type)b.push('"'+a.field+
"\" LIKE '%"+a.data.value+"%'");else if("numeric"==a.data.type){var c="";switch(a.data.comparison){case "gt":c=">";break;case "lt":c="<";break;case "eq":c="="}b.push('"'+a.field+'" '+c+" "+a.data.value)}});thematicLayer.mergeNewParams({FILTER:c+":"+b.join(" AND ")})}}}});!1==k.displayInfo&&a.resultsGrid.getBottomToolbar().add([{iconCls:"x-clearfilter-icon",tooltip:TR.clearFilter,handler:function(){a.resultsGrid.filters.clearFilters()}},{iconCls:"x-clear-icon",tooltip:TR.clearSelection,handler:clearTableSelection}]);
a.resultsGrid.on("rowclick",a.onRowClick,a);a.resultsGrid.on("keypress",function(a){13==a.getKey()&&(a=this.getSelectionModel().last,this.fireEvent("rowclick",this,a))});c.add(a.resultsGrid);c.doLayout();a.resultsGrid.show();a.resultsGrid.collapsible&&a.resultsGrid.expand()}else{c=this.el;"bottom"==this.gridLocation&&(c=Ext.getCmp("BottomPanel").el);c.unmask();Ext.MessageBox.alert(searchPanelTitleString[lang],searchNoRecordsFoundString[lang]);try{Ext.getCmp("SearchPanelResultsGrid").destroy()}catch(s){}a.resultsGrid=
null}return!0}function getVisibleLayers(a,b){for(;null!=b;){if(b.attributes.checked)a.push(wmsLoader.layerTitleNameMapping[b.text]);else if(null==b.attributes.checked)for(var c=0;c<b.childNodes.length;c++)a=getVisibleLayers(a,b.childNodes[c]);b=b.nextSibling}return a}function getVisibleFlatLayers(a){visibleLayers=[];a.cascade(function(a){a.isLeaf()&&a.attributes.checked&&visibleLayers.push(wmsLoader.layerTitleNameMapping[a.text])})}
function getVisibleBackgroundLayer(){var a=null;enableBGMaps&&layerTree.root.lastChild.cascade(function(b){b.isLeaf()&&b.attributes.checked&&(a=b.text)});return a}function uniqueLayersInLegend(a){var b=[],c=a.length,d,e,g;for(e=0;e<c;e++){d=void 0;for(g=0;g<b.length;g++)if(a[e]===b[g]){d=!0;break}d||b.push(a[e])}return b}
function mapToolbarHandler(a,b){removeMeasurePopup();customMapToolbarHandler(a,b);"IdentifyTool"==a.id&&(a.pressed?(identifyToolActive=!0,activateGetFeatureInfo(!0),mainStatusText.setText(modeObjectIdentificationString[lang])):(identifyToolActive=!1,activateGetFeatureInfo(!1),hoverPopup&&removeHoverPopup(),clickPopup&&removeClickPopup(),clearFeatureSelected(),mainStatusText.setText(modeNavigationString[lang])));"measureDistance"==a.id&&(a.pressed?(measureControls.line.activate(),mainStatusText.setText(modeMeasureDistanceString[lang]),
changeCursorInMap("crosshair")):(measureControls.line.deactivate(),mainStatusText.setText(modeNavigationString[lang]),changeCursorInMap("default")));"measureArea"==a.id&&(a.pressed?(measureControls.polygon.activate(),mainStatusText.setText(modeMeasureAreaString[lang]),changeCursorInMap("crosshair")):(measureControls.polygon.deactivate(),mainStatusText.setText(modeNavigationString[lang]),changeCursorInMap("default")));"EmptySearchField"==a.id&&qgisSearchCombo.clearSearchResult();if("PrintMap"==a.id)if(a.pressed){printWindow.show();
!1==printExtent.initialized&&(printExtent.addPage(),printExtent.page.lastScale=Math.round(printExtent.page.scale.data.value),printExtent.page.lastRotation=0,Ext.getCmp("PrintScaleCombobox").setValue(printExtent.page.lastScale),printExtent.page.on("change",function(a,b){a.scale.data.value!=printExtent.page.lastScale&&(Ext.getCmp("PrintScaleCombobox").setValue(a.scale.data.value),printExtent.page.lastScale=a.scale.data.value);Math.round(a.rotation)!=printExtent.page.lastRotation&&(Ext.getCmp("PrintLayoutRotation").setValue(Math.round(a.rotation)),
printExtent.page.lastRotation=Math.round(a.rotation))}),printExtent.initialized=!0);var c=Ext.getCmp("PrintLayoutsCombobox"),d=c.store.findExact("name",c.getValue()),c=c.store.getAt(d);printProvider.layout.data.size.width==c.data.size.width&&printProvider.layout.data.size.height==c.data.size.height||printProvider.setLayout(c);printExtent.page.setRotation(0,!0);Ext.getCmp("PrintLayoutRotation").setValue(0);printExtent.page.fit(geoExtMap,{mode:"screen"});printExtent.show();mainStatusText.setText(modePrintingString[lang])}else printWindow.hide(),
printExtent.hide(),mainStatusText.setText(modeNavigationString[lang]);"navZoomBoxButton"==a.id&&(a.pressed?(geoExtMap.map.zoomBoxActive=!0,mainStatusText.setText(modeZoomRectangle[lang])):(geoExtMap.map.zoomBoxActive=!1,mainStatusText.setText(modeNavigationString[lang])));"navZoomFullExtent"==a.id&&geoExtMap.map.zoomToExtent(maxExtent,!1);"SendPermalink"==a.id&&(c=createPermalink(),permaLinkURLShortener?(d="http://"+location.href.split(/\/+/)[1],Ext.Ajax.request({url:d+permaLinkURLShortener,success:receiveShortPermalinkFromDB,
failure:function(a,b){alert("failed to get short URL from Python wsgi script.\n\nError Message:\n\n"+a.responseText)},method:"GET",params:{longPermalink:c}})):openPermaLink(c));"ShowHelp"==a.id&&(!0==help_active?(help_active=!1,helpWin.close()):(help_active=!0,"undefined"===typeof helpfile&&(helpfile="help_en.html",-1!=availableHelpLanguages.indexOf(lang)&&(helpfile="help_"+lang+".html")),helpWin=new Ext.Window({title:helpWindowTitleString[lang],width:geoExtMap.getWidth(),height:0.7*geoExtMap.getHeight(),
id:"autoload-win",autoScroll:!0,maximizable:!0,autoLoad:{url:helpfile},listeners:{show:function(){this.loadMask=new Ext.LoadMask(this.body,{msg:pleaseWaitString[lang]})},hide:function(){help_active=!1;helpWin.close()}}}),helpWin.show()));"geoLocate"==a.id&&(c=Ext.getCmp("geoLocate").baseAction.control,featureInfoHighlightLayer.removeAllFeatures(),a.pressed?(c.deactivate(),c.watch=!1):c.activate())}
function removeMeasurePopup(){var a=geoExtMap.map;measurePopup&&(a.removePopup(measurePopup),measurePopup.destroy(),measurePopup=null)}
function handleMeasurements(a){var b=a.geometry,c=a.units,d=a.measure,e="",e=1==a.order?e+(measureDistanceResultPrefixString[lang]+": "+d.toFixed(2)+c):e+(measureAreaResultPrefixString[lang]+": "+d.toFixed(2)+c+"<sup>2</sup>");a=geoExtMap.map;removeMeasurePopup();measurePopup=new OpenLayers.Popup.Anchored("measurePopup",b.getBounds().getCenterLonLat(),null,e,null,!1,null);measurePopup.autoSize=!0;measurePopup.keepInMap=!0;measurePopup.panMapIfOutOfView=!0;a.addPopup(measurePopup);measurePopup.setOpacity(0.8)}
function displayLoadMask(){mapIsLoading&&(loadMask=new Ext.LoadMask(Ext.getCmp("MapPanel").body,{msg:mapLoadingString[lang]}),loadMask.show())}function changeCursorInMap(a){Ext.query(".olMapViewport",document.getElementById("geoExtMapPanel"))[0].style.cursor=a}function scrollToHelpItem(a){Ext.get(a).dom.scrollIntoView()}
function createPermalink(){var a=[],b,c={},a=getVisibleLayers(a,layerTree.root.firstChild),a=uniqueLayersInLegend(a),d=getVisibleBackgroundLayer();b=geoExtMap.map.getExtent().toArray();var e=b[0]+","+b[1]+","+b[2]+","+b[3];norewrite?(b=urlArray[0]+"?map=",b=b+"/"+wmsMapName.replace("/",""),b.match(/\.qgs$/)||(b+=".qgs"),b+="&"):(b="http://"+location.href.split(/\/+/)[1],b=projectData.gis_projects?b+projectData.gis_projects.path:b+"/",b+=wmsMapName+"?");c.startExtent=e;c.visibleBackgroundLayer=d;c.visibleLayers=
a.toString();a=null;for(layer in wmsLoader.layerProperties)wmsLoader.layerProperties.hasOwnProperty(layer)&&(d=wmsLoader.layerProperties[layer].opacity,255!=d&&(null==a&&(a={}),a[layer]=d));null!=a&&(c.opacities=Ext.util.JSON.encode(a));showLayerOrderTab&&(c.initialLayerOrder=layerOrderPanel.orderedLayers().toString());c.lang=lang;"undefined"!=typeof thematicLayer.params.SELECTION&&(c.selection=thematicLayer.params.SELECTION);return b=permaLinkURLShortener?encodeURIComponent(b+decodeURIComponent(Ext.urlEncode(c))):
b+Ext.urlEncode(c)}function addAbstractToLayerGroups(){var a=layerTree.getNodeById("wmsNode");a.firstChild.cascade(function(b){b.isLeaf()||(wmsLoader.layerProperties[wmsLoader.layerTitleNameMapping[b.text]]["abstract"]=b==a.firstChild?wmsLoader.projectSettings.service["abstract"]:layerGroupString[lang]+' "'+b.text+'"')})}
function applyPermalinkParams(){var a=void 0;urlParams.opacities&&(a=Ext.util.JSON.decode(urlParams.opacities));if(a)for(layer in a)a.hasOwnProperty(layer)&&(wmsLoader.layerProperties[layer].opacity=a[layer])}function activateGetFeatureInfo(a){a?(WMSGetFInfo.activate(),enableHoverPopup&&WMSGetFInfoHover.activate()):(WMSGetFInfo.deactivate(),enableHoverPopup&&WMSGetFInfoHover.deactivate())}
function openPermaLink(a){"undefined"!=typeof PermaLinkWin&&PermaLinkWin.close();PermaLinkWin=(new Ext.Window({title:sendPermalinkLinkFromString[lang],width:200,layout:"fit",items:[{xtype:"textarea",grow:!0,value:a,anchor:"100%",selectOnFocus:!0}]})).show()}function receiveShortPermalinkFromDB(a,b){a=eval("("+a.responseText+")");openPermaLink(a.shortUrl)}
function imageFormatForLayers(a){var b=origFormat;if(0<layerImageFormats.length&&origFormat.match(/8bit/))for(var c=0;c<layerImageFormats.length;c++){for(var d=layerImageFormats[c],e=0;e<d.layers.length;e++)if(-1!=a.indexOf(d.layers[e])){b=d.format;break}if(b!=origFormat)break}return b}
function setGrayNameWhenOutsideScale(){if(grayLayerNameWhenOutsideScale){var a=[];layerTree.root.firstChild.cascade(function(b){b.isLeaf()&&a.push([b.text,b.id])});for(var b=0;b<wmsLoader.projectSettings.capability.layers.length;b++)if(MaxScale=Math.round(wmsLoader.projectSettings.capability.layers[b].maxScale),1>MaxScale&&(MaxScale=1),MinScale=Math.round(wmsLoader.projectSettings.capability.layers[b].minScale),1>MinScale&&(MinScale=15E7),wmsLoader.projectSettings.capability.layers[b].maxScale>geoExtMap.map.getScale()||
wmsLoader.projectSettings.capability.layers[b].minScale<geoExtMap.map.getScale())for(var c=0;c<a.length;c++)a[c][0]==wmsLoader.projectSettings.capability.layers[b].title&&(layerTree.root.findChild("id",a[c][1],!0).setCls("outsidescale"),strTOCTooltip=tooltipLayerTreeLayerOutsideScale[lang]+" 1:"+MaxScale+" - 1:"+MinScale,layerTree.root.findChild("id",a[c][1],!0).setTooltip(strTOCTooltip),layerTree.root.findChild("id",a[c][1],!0).isOutsideScale=!0,layerTree.root.findChild("id",a[c][1],!0).MinScale=
MinScale,layerTree.root.findChild("id",a[c][1],!0).MaxScale=MaxScale);else for(c=0;c<a.length;c++)a[c][0]==wmsLoader.projectSettings.capability.layers[b].title&&(layerTree.root.findChild("id",a[c][1],!0).setTooltip(""),node=layerTree.root.findChild("id",a[c][1],!0),node.ui.removeClass("outsidescale"),layerTree.root.findChild("id",a[c][1],!0).isOutsideScale=!1,layerTree.root.findChild("id",a[c][1],!0).MinScale=MinScale,layerTree.root.findChild("id",a[c][1],!0).MinScale=MaxScale);var d=[],e=[],g=[],
f=[];layerTree.root.firstChild.cascade(function(a){a.isLeaf()||(layerTree.root.findChild("id",a.id,!0).cascade(function(a){a.isLeaf()&&(e.push(a.isOutsideScale),g.push(a.MaxScale),f.push(a.MinScale))}),d.push([a.id,a.text,e,g,f]));e=[];g=[];f=[]});for(b=0;b<d.length;b++){bolGroupOutsideScale=!0;MinScale=0;MaxScale=15E7;for(c=0;c<d[b][2].length;c++)MinScale<d[b][4][c]&&(MinScale=d[b][4][c]),MaxScale>d[b][3][c]&&(MaxScale=d[b][3][c]),d[b][2][c]||(bolGroupOutsideScale=!1);bolGroupOutsideScale?(layerTree.root.findChild("id",
d[b][0],!0).setCls("outsidescale"),strTOCTooltip=tooltipLayerTreeLayerOutsideScale[lang]+" 1:"+MaxScale+" - 1:"+MinScale,layerTree.root.findChild("id",d[b][0],!0).setTooltip(strTOCTooltip)):(node=layerTree.root.findChild("id",d[b][0],!0),node.ui.removeClass("outsidescale"),layerTree.root.findChild("id",d[b][0],!0).setTooltip(""))}}}function exceptionLoading(a){loadMask.hide();Ext.Msg.show({title:"Error code: "+a.status,msg:a.responseText,buttons:Ext.MessageBox.OK,fn:logout})}
function logout(){window.location.href="./admin/login.php?action=logout"};
